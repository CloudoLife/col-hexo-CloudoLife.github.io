<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="sJgro_9-KyRL3EkTM5KW84pQPrg2Fv1KdkibDRBIulE">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"cloudolife.com","root":"/","images":"/images","scheme":"Pisces","darkmode":true,"version":"8.23.1","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null,"activeClass":"gitalk"},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="viper Viper is a complete configuration solution for Go applications including 12-Factor apps. It is designed to work within an application, and can handle all types of configuration needs and formats">
<meta property="og:type" content="article">
<meta property="og:title" content="[Awesome Go] Use viper to load local or remote config from file &amp; environment variables and write config to file in Golang (Go)">
<meta property="og:url" content="https://cloudolife.com/2020/03/14/Programming-Language/Golang-Go/Awesome-Go/Use-viper-to-load-local-or-remote-config-from-file-environment-variables-and-write-config-to-file-in-Golang-Go/index.html">
<meta property="og:site_name" content="Cloud-oriented Life">
<meta property="og:description" content="viper Viper is a complete configuration solution for Go applications including 12-Factor apps. It is designed to work within an application, and can handle all types of configuration needs and formats">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-03-14T00:00:00.000Z">
<meta property="article:modified_time" content="2025-06-10T09:49:34.927Z">
<meta property="article:author" content="CloudoLife">
<meta property="article:tag" content="Golang (Go)">
<meta property="article:tag" content="etcd">
<meta property="article:tag" content="Gopkg">
<meta property="article:tag" content="Awesome Go">
<meta property="article:tag" content="Configuration">
<meta property="article:tag" content="struc">
<meta property="article:tag" content="Marshal">
<meta property="article:tag" content="Unmarshal">
<meta property="article:tag" content="Viper">
<meta property="article:tag" content="Configuration File">
<meta property="article:tag" content="Environment Variable">
<meta property="article:tag" content="consul">
<meta property="article:tag" content="Twelve-Factor &#x2F; 12-Factor">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://cloudolife.com/2020/03/14/Programming-Language/Golang-Go/Awesome-Go/Use-viper-to-load-local-or-remote-config-from-file-environment-variables-and-write-config-to-file-in-Golang-Go/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://cloudolife.com/2020/03/14/Programming-Language/Golang-Go/Awesome-Go/Use-viper-to-load-local-or-remote-config-from-file-environment-variables-and-write-config-to-file-in-Golang-Go/","path":"2020/03/14/Programming-Language/Golang-Go/Awesome-Go/Use-viper-to-load-local-or-remote-config-from-file-environment-variables-and-write-config-to-file-in-Golang-Go/","title":"[Awesome Go] Use viper to load local or remote config from file & environment variables and write config to file in Golang (Go)"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>[Awesome Go] Use viper to load local or remote config from file & environment variables and write config to file in Golang (Go) | Cloud-oriented Life</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-8Y9QPJWXQN"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-8Y9QPJWXQN","only_pageview":false,"measure_protocol_api_secret":null}</script>
  <script src="/js/third-party/analytics/google-analytics.js" defer></script>

  <script src="/js/third-party/analytics/baidu-analytics.js" defer></script>
  <script async src="https://hm.baidu.com/hm.js?995d7016a56cfd5c2ef6f2e6640a670e"></script>







  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script><script src="/js/bookmark.js" defer></script><script src="/js/pjax.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.3.1/pdfobject.min.js","integrity":"sha256-jI72I8ZLVflVOisZIOaLvRew3tyvzeu6aZXFm7P7dEo="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="/js/third-party/tags/pdf.js" defer></script>






  
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>






<script data-ad-client="ca-pub-8693122033969144" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Cloud-oriented Life" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Cloud-oriented Life</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Cloud Native Technology Improves Lives</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">1646</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">331</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">584</span></a></li><li class="menu-item menu-item-ansible"><a href="/tags/Ansible/" rel="section"><i class="fa fa-book fa-fw"></i>Ansible</a></li><li class="menu-item menu-item-awesome-software"><a href="/tags/Awesome-Software/" rel="section"><i class="fa fa-book fa-fw"></i>Awesome Software</a></li><li class="menu-item menu-item-golang-(go)"><a href="/tags/Golang-Go/" rel="section"><i class="fa fa-book fa-fw"></i>Golang (Go)</a></li><li class="menu-item menu-item-helm"><a href="/tags/Helm/" rel="section"><i class="fa fa-book fa-fw"></i>Helm</a></li><li class="menu-item menu-item-java"><a href="/tags/Java/" rel="section"><i class="fa fa-book fa-fw"></i>Java</a></li><li class="menu-item menu-item-javascript"><a href="/tags/JavaScript/" rel="section"><i class="fa fa-book fa-fw"></i>JavaScript</a></li><li class="menu-item menu-item-knative"><a href="/tags/Knative/" rel="section"><i class="fa fa-book fa-fw"></i>Knative</a></li><li class="menu-item menu-item-kubernetes-(k8s)"><a href="/tags/Kubernetes-K8S/" rel="section"><i class="fa fa-book fa-fw"></i>Kubernetes (K8S)</a></li><li class="menu-item menu-item-macos"><a href="/tags/macOS/" rel="section"><i class="fa fa-book fa-fw"></i>macOS</a></li><li class="menu-item menu-item-python"><a href="/tags/Python/" rel="section"><i class="fa fa-book fa-fw"></i>Python</a></li><li class="menu-item menu-item-pulumi"><a href="/tags/Pulumi/" rel="section"><i class="fa fa-book fa-fw"></i>Pulumi</a></li><li class="menu-item menu-item-react"><a href="/tags/React/" rel="section"><i class="fa fa-book fa-fw"></i>React</a></li><li class="menu-item menu-item-ruby"><a href="/tags/Ruby/" rel="section"><i class="fa fa-book fa-fw"></i>Ruby</a></li><li class="menu-item menu-item-ruby-on-rails"><a href="/tags/Ruby-on-Rails-RoR/" rel="section"><i class="fa fa-book fa-fw"></i>Ruby On Rails</a></li><li class="menu-item menu-item-rust"><a href="/tags/Rust/" rel="section"><i class="fa fa-book fa-fw"></i>Rust</a></li><li class="menu-item menu-item-serverless"><a href="/tags/Serverless/" rel="section"><i class="fa fa-book fa-fw"></i>Serverless</a></li><li class="menu-item menu-item-service-mesh"><a href="/tags/Service-Mesh/" rel="section"><i class="fa fa-book fa-fw"></i>Service Mesh</a></li><li class="menu-item menu-item-svelte"><a href="/tags/Svelte/" rel="section"><i class="fa fa-book fa-fw"></i>Svelte</a></li><li class="menu-item menu-item-taro"><a href="/tags/Taro/" rel="section"><i class="fa fa-book fa-fw"></i>Taro</a></li><li class="menu-item menu-item-terraform"><a href="/tags/Terraform/" rel="section"><i class="fa fa-book fa-fw"></i>Terraform</a></li><li class="menu-item menu-item-typescript"><a href="/tags/TypeScript/" rel="section"><i class="fa fa-book fa-fw"></i>TypeScript</a></li><li class="menu-item menu-item-about"><a href="/about-us/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>Sitemap</a></li><li class="menu-item menu-item-rss"><a href="/atom.xml" rel="section"><i class="fa fa-rss fa-fw"></i>RSS</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="Searching..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">1.</span> <span class="nav-text">viper</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Installation"><span class="nav-number">1.1.</span> <span class="nav-text">Installation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Usage"><span class="nav-number">1.2.</span> <span class="nav-text">Usage</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Establishing-Defaults"><span class="nav-number">1.2.1.</span> <span class="nav-text">Establishing Defaults</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Reading-Config-Files"><span class="nav-number">1.2.2.</span> <span class="nav-text">Reading Config Files</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Writing-Config-Files"><span class="nav-number">1.2.3.</span> <span class="nav-text">Writing Config Files</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Watching-and-re-reading-config-files"><span class="nav-number">1.2.4.</span> <span class="nav-text">Watching and re-reading config files</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Reading-Config-from-io-Reader"><span class="nav-number">1.2.5.</span> <span class="nav-text">Reading Config from io.Reader</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Working-with-Environment-Variables"><span class="nav-number">1.2.6.</span> <span class="nav-text">Working with Environment Variables</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Working-with-Flags"><span class="nav-number">1.2.7.</span> <span class="nav-text">Working with Flags</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Flag-interfaces"><span class="nav-number">1.2.8.</span> <span class="nav-text">Flag interfaces</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Remote-Key-Value-Store-Support"><span class="nav-number">1.2.9.</span> <span class="nav-text">Remote Key&#x2F;Value Store Support</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Remote-Key-Value-Store-Example-Unencrypted"><span class="nav-number">1.2.9.1.</span> <span class="nav-text">Remote Key&#x2F;Value Store Example - Unencrypted</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#etcd"><span class="nav-number">1.2.9.2.</span> <span class="nav-text">etcd</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Consul"><span class="nav-number">1.2.9.2.1.</span> <span class="nav-text">Consul</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Firestore"><span class="nav-number">1.2.9.2.2.</span> <span class="nav-text">Firestore</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Remote-Key-Value-Store-Example-Encrypted"><span class="nav-number">1.2.9.3.</span> <span class="nav-text">Remote Key&#x2F;Value Store Example - Encrypted</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Watching-Changes-in-etcd-Unencrypted"><span class="nav-number">1.2.9.4.</span> <span class="nav-text">Watching Changes in etcd - Unencrypted</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Getting-Values-From-Viper"><span class="nav-number">1.2.10.</span> <span class="nav-text">Getting Values From Viper</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Accessing-nested-keys"><span class="nav-number">1.2.11.</span> <span class="nav-text">Accessing nested keys</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Extracting-a-sub-tree"><span class="nav-number">1.2.12.</span> <span class="nav-text">Extracting a sub-tree</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Unmarshaling"><span class="nav-number">1.2.13.</span> <span class="nav-text">Unmarshaling</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Marshalling-to-string"><span class="nav-number">1.2.14.</span> <span class="nav-text">Marshalling to string</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#References"><span class="nav-number">1.3.</span> <span class="nav-text">References</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">CloudoLife</p>
  <div class="site-description" itemprop="description">A Husband and Father, Knowledge Worker, Full-skilled Cloud Engineer</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">584</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">331</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">1646</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/CloudoLife" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;CloudoLife" rel="noopener me external nofollow noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/CloudoLife" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;CloudoLife" rel="noopener me external nofollow noreferrer" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          Links
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <a href="https://cloudolife.cn/" title="https:&#x2F;&#x2F;cloudolife.cn" rel="noopener external nofollow noreferrer" target="_blank">CLoudoLife - Chinese (Simplified)</a>
            </li>
        </ul>
      </div>
    </div>
        <div class="pjax">
        </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://cloudolife.com/2020/03/14/Programming-Language/Golang-Go/Awesome-Go/Use-viper-to-load-local-or-remote-config-from-file-environment-variables-and-write-config-to-file-in-Golang-Go/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CloudoLife">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cloud-oriented Life">
      <meta itemprop="description" content="A Husband and Father, Knowledge Worker, Full-skilled Cloud Engineer">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="[Awesome Go] Use viper to load local or remote config from file &amp; environment variables and write config to file in Golang (Go) | Cloud-oriented Life">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          [Awesome Go] Use viper to load local or remote config from file & environment variables and write config to file in Golang (Go)
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-03-14 00:00:00" itemprop="dateCreated datePublished" datetime="2020-03-14T00:00:00+00:00">2020-03-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-06-10 09:49:34" itemprop="dateModified" datetime="2025-06-10T09:49:34+00:00">2025-06-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming-Language/" itemprop="url" rel="index"><span itemprop="name">Programming Language</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming-Language/Golang-Go/" itemprop="url" rel="index"><span itemprop="name">Golang (Go)</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming-Language/Golang-Go/Awesome-Go/" itemprop="url" rel="index"><span itemprop="name">Awesome Go</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>20k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>18 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1>viper</h1>
<p>Viper is a complete configuration solution for Go applications including <code>12-Factor</code> apps. It is designed to work within an application, and can handle all types of configuration needs and formats. It supports:</p>
<span id="more"></span>
<ul>
<li>
<p>setting defaults</p>
</li>
<li>
<p>reading from JSON, TOML, YAML, HCL, envfile and Java properties config files</p>
</li>
<li>
<p>live watching and re-reading of config files (optional)</p>
</li>
<li>
<p>reading from environment variables</p>
</li>
<li>
<p>reading from remote config systems (etcd or Consul), and watching changes</p>
</li>
<li>
<p>reading from command line flags</p>
</li>
<li>
<p>reading from buffer</p>
</li>
<li>
<p>setting explicit values</p>
</li>
</ul>
<p>Viper can be thought of as a registry for all of your applications configuration needs.</p>
<p>Viper uses the following precedence order. Each item takes precedence over the item below it:</p>
<ul>
<li>
<p>explicit call to <code>Set</code></p>
</li>
<li>
<p>flag</p>
</li>
<li>
<p>env</p>
</li>
<li>
<p>config</p>
</li>
<li>
<p>key/value store</p>
</li>
<li>
<p>default</p>
</li>
</ul>
<hr>
<p>Important: Viper configuration keys are case insensitive. There are ongoing discussions about making that optional.</p>
<hr>
<h2 id="Installation">Installation</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">go get -u github.com/spf13/viper</span></span><br></pre></td></tr></table></figure>
<h2 id="Usage">Usage</h2>
<h3 id="Establishing-Defaults">Establishing Defaults</h3>
<p>A good configuration system will support default values. A default value is not required for a key, but it’s useful in the event that a key hasn’t been set via config file, environment variable, remote configuration or flag.</p>
<p>Examples:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">viper.SetDefault(<span class="string">&quot;ContentDir&quot;</span>, <span class="string">&quot;content&quot;</span>)</span><br><span class="line">viper.SetDefault(<span class="string">&quot;LayoutDir&quot;</span>, <span class="string">&quot;layouts&quot;</span>)</span><br><span class="line">viper.SetDefault(<span class="string">&quot;Taxonomies&quot;</span>, <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>&#123;<span class="string">&quot;tag&quot;</span>: <span class="string">&quot;tags&quot;</span>, <span class="string">&quot;category&quot;</span>: <span class="string">&quot;categories&quot;</span>&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="Reading-Config-Files">Reading Config Files</h3>
<p>Viper requires minimal configuration so it knows where to look for config files. Viper supports JSON, TOML, YAML, HCL, INI, envfile and Java Properties files. Viper can search multiple paths, but currently a single Viper instance only supports a single configuration file. Viper does not default to any configuration search paths leaving defaults decision to an application.</p>
<p>Here is an example of how to use Viper to search for and read a configuration file. None of the specific paths are required, but at least one path should be provided where a configuration file is expected.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">viper.SetConfigName(<span class="string">&quot;config&quot;</span>) <span class="comment">// name of config file (without extension)</span></span><br><span class="line">viper.SetConfigType(<span class="string">&quot;yaml&quot;</span>) <span class="comment">// REQUIRED if the config file does not have the extension in the name</span></span><br><span class="line">viper.AddConfigPath(<span class="string">&quot;/etc/appname/&quot;</span>)   <span class="comment">// path to look for the config file in</span></span><br><span class="line">viper.AddConfigPath(<span class="string">&quot;$HOME/.appname&quot;</span>)  <span class="comment">// call multiple times to add many search paths</span></span><br><span class="line">viper.AddConfigPath(<span class="string">&quot;.&quot;</span>)               <span class="comment">// optionally look for config in the working directory</span></span><br><span class="line">err := viper.ReadInConfig() <span class="comment">// Find and read the config file</span></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123; <span class="comment">// Handle errors reading the config file</span></span><br><span class="line">	<span class="built_in">panic</span>(fmt.Errorf(<span class="string">&quot;Fatal error config file: %s \n&quot;</span>, err))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>You can handle the specific case where no config file is found like this:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> err := viper.ReadInConfig(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> _, ok := err.(viper.ConfigFileNotFoundError); ok &#123;</span><br><span class="line">        <span class="comment">// Config file not found; ignore error if desired</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Config file was found but another error was produced</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Config file found and successfully parsed</span></span><br></pre></td></tr></table></figure>
<h3 id="Writing-Config-Files">Writing Config Files</h3>
<p>Reading from config files is useful, but at times you want to store all modifications made at run time. For that, a bunch of commands are available, each with its own purpose:</p>
<p>A small examples section:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">viper.WriteConfig() <span class="comment">// writes current config to predefined path set by &#x27;viper.AddConfigPath()&#x27; and &#x27;viper.SetConfigName&#x27;</span></span><br><span class="line">viper.SafeWriteConfig() <span class="comment">// writes the current viper configuration to the predefined path. Errors if no predefined path. Will not overwrite the current config file, if it exists.</span></span><br><span class="line">viper.WriteConfigAs(<span class="string">&quot;/path/to/my/.config&quot;</span>) <span class="comment">// writes the current viper configuration to the given filepath. Will overwrite the given file, if it exists</span></span><br><span class="line">viper.SafeWriteConfigAs(<span class="string">&quot;/path/to/my/.config&quot;</span>) <span class="comment">// will error since it has already been written</span></span><br><span class="line">viper.SafeWriteConfigAs(<span class="string">&quot;/path/to/my/.other_config&quot;</span>) <span class="comment">// writes the current viper configuration to the given filepath. Will not overwrite the given file, if it exists.</span></span><br></pre></td></tr></table></figure>
<h3 id="Watching-and-re-reading-config-files">Watching and re-reading config files</h3>
<p>Viper supports the ability to have your application live read a config file while running.</p>
<p>Make sure you add all of the <code>configPaths()</code> prior to calling <code>WatchConfig()</code>.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">viper.WatchConfig()</span><br><span class="line">viper.OnConfigChange(<span class="function"><span class="keyword">func</span><span class="params">(e fsnotify.Event)</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;Config file changed:&quot;</span>, e.Name)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="Reading-Config-from-io-Reader">Reading Config from io.Reader</h3>
<p>Viper predefines many configuration sources such as files, environment variables, flags, and remote K/V store, but you are not bound to them. You can also implement your own required configuration source and feed it to viper.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">viper.SetConfigType(<span class="string">&quot;yaml&quot;</span>) <span class="comment">// or viper.SetConfigType(&quot;YAML&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// any approach to require this configuration into your program.</span></span><br><span class="line"><span class="keyword">var</span> yamlExample = []<span class="type">byte</span>(<span class="string">`</span></span><br><span class="line"><span class="string">Hacker: true</span></span><br><span class="line"><span class="string">name: steve</span></span><br><span class="line"><span class="string">hobbies:</span></span><br><span class="line"><span class="string">- skateboarding</span></span><br><span class="line"><span class="string">- snowboarding</span></span><br><span class="line"><span class="string">- go</span></span><br><span class="line"><span class="string">clothing:</span></span><br><span class="line"><span class="string">  jacket: leather</span></span><br><span class="line"><span class="string">  trousers: denim</span></span><br><span class="line"><span class="string">age: 35</span></span><br><span class="line"><span class="string">eyes : brown</span></span><br><span class="line"><span class="string">beard: true</span></span><br><span class="line"><span class="string">`</span>)</span><br><span class="line"></span><br><span class="line">viper.ReadConfig(bytes.NewBuffer(yamlExample))</span><br><span class="line"></span><br><span class="line">viper.Get(<span class="string">&quot;name&quot;</span>) <span class="comment">// this would be &quot;steve&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="Working-with-Environment-Variables">Working with Environment Variables</h3>
<p>Viper has full support for environment variables. This enables 12 factor applications out of the box. There are five methods that exist to aid working with ENV:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">AutomaticEnv()</span><br><span class="line"></span><br><span class="line">BindEnv(<span class="type">string</span>...) : <span class="type">error</span></span><br><span class="line"></span><br><span class="line">SetEnvPrefix(<span class="type">string</span>)</span><br><span class="line"></span><br><span class="line">SetEnvKeyReplacer(<span class="type">string</span>...) *strings.Replacer</span><br><span class="line"></span><br><span class="line">AllowEmptyEnv(<span class="type">bool</span>)</span><br></pre></td></tr></table></figure>
<p>When working with <code>ENV</code> variables, it’s important to recognize that Viper treats <code>ENV</code> variables as case sensitive.</p>
<p>Viper provides a mechanism to try to ensure that <code>ENV</code> variables are unique. By using <code>SetEnvPrefix</code>, you can tell Viper to use a prefix while reading from the environment variables. Both BindEnv and AutomaticEnv will use this prefix.</p>
<p>BindEnv takes one or more parameters. The first parameter is the key name, the rest are the name of the environment variables to bind to this key. If more than one are provided, they will take precedence in the specified order. The name of the environment variable is case sensitive. If the ENV variable name is not provided, then Viper will automatically assume that the ENV variable matches the following format: prefix + “_” + the key name in ALL CAPS. When you explicitly provide the ENV variable name (the second parameter), it does not automatically add the prefix. For example if the second parameter is “id”, Viper will look for the ENV variable “ID”.</p>
<p>One important thing to recognize when working with <code>ENV</code> variables is that the value will be read each time it is accessed. Viper does not fix the value when the BindEnv is called.</p>
<p><code>AutomaticEnv</code> is a powerful helper especially when combined with <code>SetEnvPrefix</code>. When called, Viper will check for an environment variable any time a viper.Get request is made. It will apply the following rules. It will check for an environment variable with a name matching the key uppercased and prefixed with the <code>EnvPrefix</code> if set.</p>
<p><code>SetEnvKeyReplacer</code> allows you to use a <code>strings.Replacer</code> object to rewrite <code>Env</code> keys to an extent. This is useful if you want to use <code>-</code> or something in your <code>Get()</code> calls, but want your environmental variables to use <code>_</code> delimiters. An example of using it can be found in <code>viper_test.go</code>.</p>
<p>Alternatively, you can use <code>EnvKeyReplacer</code> with <code>NewWithOptions</code> factory function. Unlike <code>SetEnvKeyReplacer</code>, it accepts a <code>StringReplacer</code> interface allowing you to write custom string replacing logic.</p>
<p>By default empty environment variables are considered unset and will fall back to the next configuration source. To treat empty environment variables as set, use the <code>AllowEmptyEnv</code> method.</p>
<p>Env example</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SetEnvPrefix(<span class="string">&quot;spf&quot;</span>) <span class="comment">// will be uppercased automatically</span></span><br><span class="line">BindEnv(<span class="string">&quot;id&quot;</span>)</span><br><span class="line"></span><br><span class="line">os.Setenv(<span class="string">&quot;SPF_ID&quot;</span>, <span class="string">&quot;13&quot;</span>) <span class="comment">// typically done outside of the app</span></span><br><span class="line"></span><br><span class="line">id := Get(<span class="string">&quot;id&quot;</span>) <span class="comment">// 13</span></span><br></pre></td></tr></table></figure>
<h3 id="Working-with-Flags">Working with Flags</h3>
<p>Viper has the ability to bind to flags. Specifically, Viper supports <code>Pflags</code> as used in the <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/spf13/cobra">GitHub - spf13/cobra: A Commander for modern Go CLI interactions - https://github.com/spf13/cobra</a> library.</p>
<p>Like <code>BindEnv</code>, the value is not set when the binding method is called, but when it is accessed. This means you can bind as early as you want, even in an <code>init()</code> function.</p>
<p>For individual flags, the <code>BindPFlag()</code> method provides this functionality.</p>
<p>Example:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">serverCmd.Flags().Int(<span class="string">&quot;port&quot;</span>, <span class="number">1138</span>, <span class="string">&quot;Port to run Application server on&quot;</span>)</span><br><span class="line">viper.BindPFlag(<span class="string">&quot;port&quot;</span>, serverCmd.Flags().Lookup(<span class="string">&quot;port&quot;</span>))</span><br></pre></td></tr></table></figure>
<p>You can also bind an existing set of pflags (<code>pflag.FlagSet</code>):</p>
<p>Example:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pflag.Int(<span class="string">&quot;flagname&quot;</span>, <span class="number">1234</span>, <span class="string">&quot;help message for flagname&quot;</span>)</span><br><span class="line"></span><br><span class="line">pflag.Parse()</span><br><span class="line">viper.BindPFlags(pflag.CommandLine)</span><br><span class="line"></span><br><span class="line">i := viper.GetInt(<span class="string">&quot;flagname&quot;</span>) <span class="comment">// retrieve values from viper instead of pflag</span></span><br></pre></td></tr></table></figure>
<p>The use of pflag in Viper does not preclude the use of other packages that use the flag package from the standard library. The pflag package can handle the flags defined for the flag package by importing these flags. This is accomplished by a calling a convenience function provided by the pflag package called <code>AddGoFlagSet()</code>.</p>
<p>Example:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;flag&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/spf13/pflag&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// using standard library &quot;flag&quot; package</span></span><br><span class="line">	flag.Int(<span class="string">&quot;flagname&quot;</span>, <span class="number">1234</span>, <span class="string">&quot;help message for flagname&quot;</span>)</span><br><span class="line"></span><br><span class="line">	pflag.CommandLine.AddGoFlagSet(flag.CommandLine)</span><br><span class="line">	pflag.Parse()</span><br><span class="line">	viper.BindPFlags(pflag.CommandLine)</span><br><span class="line"></span><br><span class="line">	i := viper.GetInt(<span class="string">&quot;flagname&quot;</span>) <span class="comment">// retrieve value from viper</span></span><br><span class="line"></span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Flag-interfaces">Flag interfaces</h3>
<p>Viper provides two Go interfaces to bind other flag systems if you don’t use Pflags.</p>
<p>FlagValue represents a single flag. This is a very simple example on how to implement this interface:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> myFlag <span class="keyword">struct</span> &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f myFlag)</span></span> HasChanged() <span class="type">bool</span> &#123; <span class="keyword">return</span> <span class="literal">false</span> &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f myFlag)</span></span> Name() <span class="type">string</span> &#123; <span class="keyword">return</span> <span class="string">&quot;my-flag-name&quot;</span> &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f myFlag)</span></span> ValueString() <span class="type">string</span> &#123; <span class="keyword">return</span> <span class="string">&quot;my-flag-value&quot;</span> &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f myFlag)</span></span> ValueType() <span class="type">string</span> &#123; <span class="keyword">return</span> <span class="string">&quot;string&quot;</span> &#125;</span><br></pre></td></tr></table></figure>
<p>Once your flag implements this interface, you can simply tell Viper to bind it:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">viper.BindFlagValue(<span class="string">&quot;my-flag-name&quot;</span>, myFlag&#123;&#125;)</span><br></pre></td></tr></table></figure>
<p>FlagValueSet represents a group of flags. This is a very simple example on how to implement this interface:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> myFlagSet <span class="keyword">struct</span> &#123;</span><br><span class="line">	flags []myFlag</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f myFlagSet)</span></span> VisitAll(fn <span class="function"><span class="keyword">func</span><span class="params">(FlagValue)</span></span>) &#123;</span><br><span class="line">	<span class="keyword">for</span> _, flag := <span class="keyword">range</span> flags &#123;</span><br><span class="line">		fn(flag)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Once your flag set implements this interface, you can simply tell Viper to bind it:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fSet := myFlagSet&#123;</span><br><span class="line">	flags: []myFlag&#123;myFlag&#123;&#125;, myFlag&#123;&#125;&#125;,</span><br><span class="line">&#125;</span><br><span class="line">viper.BindFlagValues(<span class="string">&quot;my-flags&quot;</span>, fSet)</span><br></pre></td></tr></table></figure>
<h3 id="Remote-Key-Value-Store-Support">Remote Key/Value Store Support</h3>
<p>To enable remote support in Viper, do a blank import of the <code>viper/remote</code> package:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> _ <span class="string">&quot;github.com/spf13/viper/remote&quot;</span></span><br></pre></td></tr></table></figure>
<p>Viper will read a config string (as JSON, TOML, YAML, HCL or envfile) retrieved from a path in a Key/Value store such as etcd or Consul. These values take precedence over default values, but are overridden by configuration values retrieved from disk, flags, or environment variables.</p>
<p>Viper uses crypt to retrieve configuration from the K/V store, which means that you can store your configuration values encrypted and have them automatically decrypted if you have the correct gpg keyring. Encryption is optional.</p>
<p>You can use remote configuration in conjunction with local configuration, or independently of it.</p>
<p>crypt has a command-line helper that you can use to put configurations in your K/V store. crypt defaults to etcd on <a target="_blank" rel="noopener external nofollow noreferrer" href="http://127.0.0.1:4001">http://127.0.0.1:4001</a>.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">go get github.com/bketelsen/crypt/bin/crypt</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">crypt <span class="built_in">set</span> -plaintext /config/hugo.json /Users/hugo/settings/config.json</span></span><br></pre></td></tr></table></figure>
<p>Confirm that your value was set:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">crypt get -plaintext /config/hugo.json</span></span><br></pre></td></tr></table></figure>
<p>See the crypt documentation for examples of how to set encrypted values, or how to use Consul.</p>
<h4 id="Remote-Key-Value-Store-Example-Unencrypted">Remote Key/Value Store Example - Unencrypted</h4>
<h4 id="etcd">etcd</h4>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">viper.AddRemoteProvider(<span class="string">&quot;etcd&quot;</span>, <span class="string">&quot;http://127.0.0.1:4001&quot;</span>,<span class="string">&quot;/config/hugo.json&quot;</span>)</span><br><span class="line">viper.SetConfigType(<span class="string">&quot;json&quot;</span>) <span class="comment">// because there is no file extension in a stream of bytes, supported extensions are &quot;json&quot;, &quot;toml&quot;, &quot;yaml&quot;, &quot;yml&quot;, &quot;properties&quot;, &quot;props&quot;, &quot;prop&quot;, &quot;env&quot;, &quot;dotenv&quot;</span></span><br><span class="line">err := viper.ReadRemoteConfig()</span><br></pre></td></tr></table></figure>
<h5 id="Consul">Consul</h5>
<p>You need to set a key to Consul key/value storage with JSON value containing your desired config. For example, create a Consul key/value store key MY_CONSUL_KEY with value:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;port&quot;</span>: <span class="number">8080</span>,</span><br><span class="line">    <span class="string">&quot;hostname&quot;</span>: <span class="string">&quot;myhostname.com&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">viper.AddRemoteProvider(<span class="string">&quot;consul&quot;</span>, <span class="string">&quot;localhost:8500&quot;</span>, <span class="string">&quot;MY_CONSUL_KEY&quot;</span>)</span><br><span class="line">viper.SetConfigType(<span class="string">&quot;json&quot;</span>) <span class="comment">// Need to explicitly set this to json</span></span><br><span class="line">err := viper.ReadRemoteConfig()</span><br><span class="line"></span><br><span class="line">fmt.Println(viper.Get(<span class="string">&quot;port&quot;</span>)) <span class="comment">// 8080</span></span><br><span class="line">fmt.Println(viper.Get(<span class="string">&quot;hostname&quot;</span>)) <span class="comment">// myhostname.com</span></span><br></pre></td></tr></table></figure>
<h5 id="Firestore">Firestore</h5>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">viper.AddRemoteProvider(<span class="string">&quot;firestore&quot;</span>, <span class="string">&quot;google-cloud-project-id&quot;</span>, <span class="string">&quot;collection/document&quot;</span>)</span><br><span class="line">viper.SetConfigType(<span class="string">&quot;json&quot;</span>) <span class="comment">// Config&#x27;s format: &quot;json&quot;, &quot;toml&quot;, &quot;yaml&quot;, &quot;yml&quot;</span></span><br><span class="line">err := viper.ReadRemoteConfig()</span><br></pre></td></tr></table></figure>
<p>Of course, you’re allowed to use SecureRemoteProvider also</p>
<h4 id="Remote-Key-Value-Store-Example-Encrypted">Remote Key/Value Store Example - Encrypted</h4>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">viper.AddSecureRemoteProvider(<span class="string">&quot;etcd&quot;</span>,<span class="string">&quot;http://127.0.0.1:4001&quot;</span>,<span class="string">&quot;/config/hugo.json&quot;</span>,<span class="string">&quot;/etc/secrets/mykeyring.gpg&quot;</span>)</span><br><span class="line">viper.SetConfigType(<span class="string">&quot;json&quot;</span>) <span class="comment">// because there is no file extension in a stream of bytes,  supported extensions are &quot;json&quot;, &quot;toml&quot;, &quot;yaml&quot;, &quot;yml&quot;, &quot;properties&quot;, &quot;props&quot;, &quot;prop&quot;, &quot;env&quot;, &quot;dotenv&quot;</span></span><br><span class="line">err := viper.ReadRemoteConfig()</span><br></pre></td></tr></table></figure>
<h4 id="Watching-Changes-in-etcd-Unencrypted">Watching Changes in etcd - Unencrypted</h4>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// alternatively, you can create a new viper instance.</span></span><br><span class="line"><span class="keyword">var</span> runtime_viper = viper.New()</span><br><span class="line"></span><br><span class="line">runtime_viper.AddRemoteProvider(<span class="string">&quot;etcd&quot;</span>, <span class="string">&quot;http://127.0.0.1:4001&quot;</span>, <span class="string">&quot;/config/hugo.yml&quot;</span>)</span><br><span class="line">runtime_viper.SetConfigType(<span class="string">&quot;yaml&quot;</span>) <span class="comment">// because there is no file extension in a stream of bytes, supported extensions are &quot;json&quot;, &quot;toml&quot;, &quot;yaml&quot;, &quot;yml&quot;, &quot;properties&quot;, &quot;props&quot;, &quot;prop&quot;, &quot;env&quot;, &quot;dotenv&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// read from remote config the first time.</span></span><br><span class="line">err := runtime_viper.ReadRemoteConfig()</span><br><span class="line"></span><br><span class="line"><span class="comment">// unmarshal config</span></span><br><span class="line">runtime_viper.Unmarshal(&amp;runtime_conf)</span><br><span class="line"></span><br><span class="line"><span class="comment">// open a goroutine to watch remote changes forever</span></span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">	    time.Sleep(time.Second * <span class="number">5</span>) <span class="comment">// delay after each request</span></span><br><span class="line"></span><br><span class="line">	    <span class="comment">// currently, only tested with etcd support</span></span><br><span class="line">	    err := runtime_viper.WatchRemoteConfig()</span><br><span class="line">	    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">	        log.Errorf(<span class="string">&quot;unable to read remote config: %v&quot;</span>, err)</span><br><span class="line">	        <span class="keyword">continue</span></span><br><span class="line">	    &#125;</span><br><span class="line"></span><br><span class="line">	    <span class="comment">// unmarshal new config into our runtime config struct. you can also use channel</span></span><br><span class="line">	    <span class="comment">// to implement a signal to notify the system of the changes</span></span><br><span class="line">	    runtime_viper.Unmarshal(&amp;runtime_conf)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;()</span><br></pre></td></tr></table></figure>
<h3 id="Getting-Values-From-Viper">Getting Values From Viper</h3>
<p>In Viper, there are a few ways to get a value depending on the value’s type. The following functions and methods exist:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Get(key <span class="type">string</span>) : <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">GetBool(key <span class="type">string</span>) : <span class="type">bool</span></span><br><span class="line"></span><br><span class="line">GetFloat64(key <span class="type">string</span>) : <span class="type">float64</span></span><br><span class="line"></span><br><span class="line">GetInt(key <span class="type">string</span>) : <span class="type">int</span></span><br><span class="line"></span><br><span class="line">GetIntSlice(key <span class="type">string</span>) : []<span class="type">int</span></span><br><span class="line"></span><br><span class="line">GetString(key <span class="type">string</span>) : <span class="type">string</span></span><br><span class="line"></span><br><span class="line">GetStringMap(key <span class="type">string</span>) : <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">GetStringMapString(key <span class="type">string</span>) : <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span></span><br><span class="line"></span><br><span class="line">GetStringSlice(key <span class="type">string</span>) : []<span class="type">string</span></span><br><span class="line"></span><br><span class="line">GetTime(key <span class="type">string</span>) : time.Time</span><br><span class="line"></span><br><span class="line">GetDuration(key <span class="type">string</span>) : time.Duration</span><br><span class="line"></span><br><span class="line">IsSet(key <span class="type">string</span>) : <span class="type">bool</span></span><br><span class="line"></span><br><span class="line">AllSettings() : <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>One important thing to recognize is that each Get function will return a zero value if it’s not found. To check if a given key exists, the <code>IsSet()</code> method has been provided.</p>
<p>Example:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">viper.GetString(<span class="string">&quot;logfile&quot;</span>) <span class="comment">// case-insensitive Setting &amp; Getting</span></span><br><span class="line"><span class="keyword">if</span> viper.GetBool(<span class="string">&quot;verbose&quot;</span>) &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;verbose enabled&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Accessing-nested-keys">Accessing nested keys</h3>
<p>The accessor methods also accept formatted paths to deeply nested keys. For example, if the following JSON file is loaded:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;host&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;address&quot;</span>: <span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">        <span class="string">&quot;port&quot;</span>: <span class="number">5799</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;datastore&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;metric&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;host&quot;</span>: <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;port&quot;</span>: <span class="number">3099</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;warehouse&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;host&quot;</span>: <span class="string">&quot;198.0.0.1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;port&quot;</span>: <span class="number">2112</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Viper can access a nested field by passing a <code>.</code> delimited path of keys:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GetString(<span class="string">&quot;datastore.metric.host&quot;</span>) <span class="comment">// (returns &quot;127.0.0.1&quot;)</span></span><br></pre></td></tr></table></figure>
<p>This obeys the precedence rules established above; the search for the path will cascade through the remaining configuration registries until found.</p>
<p>For example, given this configuration file, both datastore.metric.host and datastore.metric.port are already defined (and may be overridden). If in addition datastore.metric.protocol was defined in the defaults, Viper would also find it.</p>
<p>However, if datastore.metric was overridden (by a flag, an environment variable, the Set() method, …) with an immediate value, then all sub-keys of datastore.metric become undefined, they are “shadowed” by the higher-priority configuration level.</p>
<p>Viper can access array indices by using numbers in the path. For example:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;host&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;address&quot;</span>: <span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ports&quot;</span>: [</span><br><span class="line">            <span class="number">5799</span>,</span><br><span class="line">            <span class="number">6029</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;datastore&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;metric&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;host&quot;</span>: <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;port&quot;</span>: <span class="number">3099</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;warehouse&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;host&quot;</span>: <span class="string">&quot;198.0.0.1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;port&quot;</span>: <span class="number">2112</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GetInt(<span class="string">&quot;host.ports.1&quot;</span>) <span class="comment">// returns 6029</span></span><br></pre></td></tr></table></figure>
<p>Lastly, if there exists a key that matches the delimited key path, its value will be returned instead. E.g.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;datastore.metric.host&quot;</span>: <span class="string">&quot;0.0.0.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;host&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;address&quot;</span>: <span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">        <span class="string">&quot;port&quot;</span>: <span class="number">5799</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;datastore&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;metric&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;host&quot;</span>: <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;port&quot;</span>: <span class="number">3099</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;warehouse&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;host&quot;</span>: <span class="string">&quot;198.0.0.1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;port&quot;</span>: <span class="number">2112</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GetString(<span class="string">&quot;datastore.metric.host&quot;</span>) <span class="comment">// returns &quot;0.0.0.0&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="Extracting-a-sub-tree">Extracting a sub-tree</h3>
<p>When developing reusable modules, it’s often useful to extract a subset of the configuration and pass it to a module. This way the module can be instantiated more than once, with different configurations.</p>
<p>For example, an application might use multiple different cache stores for different purposes:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cache:</span><br><span class="line">  cache1:</span><br><span class="line">    max-items: <span class="number">100</span></span><br><span class="line">    item-size: <span class="number">64</span></span><br><span class="line">  cache2:</span><br><span class="line">    max-items: <span class="number">200</span></span><br><span class="line">    item-size: <span class="number">80</span></span><br></pre></td></tr></table></figure>
<p>We could pass the cache name to a module (eg. NewCache(“cache1”)), but it would require weird concatenation for accessing config keys and would be less separated from the global config.</p>
<p>So instead of doing that let’s pass a Viper instance to the constructor that represents a subset of the configuration:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cache1Config := viper.Sub(<span class="string">&quot;cache.cache1&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> cache1Config == <span class="literal">nil</span> &#123; <span class="comment">// Sub returns nil if the key cannot be found</span></span><br><span class="line">    <span class="built_in">panic</span>(<span class="string">&quot;cache configuration not found&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cache1 := NewCache(cache1Config)</span><br></pre></td></tr></table></figure>
<hr>
<p>Note: Always check the return value of Sub. It returns nil if a key cannot be found.</p>
<hr>
<p>Internally, the <code>NewCache</code> function can address max-items and item-size keys directly:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewCache</span><span class="params">(v *Viper)</span></span> *Cache &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;Cache&#123;</span><br><span class="line">        MaxItems: v.GetInt(<span class="string">&quot;max-items&quot;</span>),</span><br><span class="line">        ItemSize: v.GetInt(<span class="string">&quot;item-size&quot;</span>),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The resulting code is easy to test, since it’s decoupled from the main config structure, and easier to reuse (for the same reason).</p>
<h3 id="Unmarshaling">Unmarshaling</h3>
<p>You also have the option of Unmarshaling all or a specific value to a <code>struct</code>, <code>map</code>, etc.</p>
<p>There are two methods to do this:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Unmarshal(rawVal <span class="keyword">interface</span>&#123;&#125;) : <span class="type">error</span></span><br><span class="line"></span><br><span class="line">UnmarshalKey(key <span class="type">string</span>, rawVal <span class="keyword">interface</span>&#123;&#125;) : <span class="type">error</span></span><br></pre></td></tr></table></figure>
<p>Example:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> config <span class="keyword">struct</span> &#123;</span><br><span class="line">	Port <span class="type">int</span></span><br><span class="line">	Name <span class="type">string</span></span><br><span class="line">	PathMap <span class="type">string</span> <span class="string">`mapstructure:&quot;path_map&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> C config</span><br><span class="line"></span><br><span class="line">err := viper.Unmarshal(&amp;C)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">	t.Fatalf(<span class="string">&quot;unable to decode into struct, %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Viper also supports unmarshaling into embedded structs:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Example config:</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">module:</span></span><br><span class="line"><span class="comment">    enabled: true</span></span><br><span class="line"><span class="comment">    token: 89h3f98hbwf987h3f98wenf89ehf</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">type</span> config <span class="keyword">struct</span> &#123;</span><br><span class="line">	Module <span class="keyword">struct</span> &#123;</span><br><span class="line">		Enabled <span class="type">bool</span></span><br><span class="line"></span><br><span class="line">		moduleConfig <span class="string">`mapstructure:&quot;,squash&quot;`</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// moduleConfig could be in a module specific package</span></span><br><span class="line"><span class="keyword">type</span> moduleConfig <span class="keyword">struct</span> &#123;</span><br><span class="line">	Token <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> C config</span><br><span class="line"></span><br><span class="line">err := viper.Unmarshal(&amp;C)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">	t.Fatalf(<span class="string">&quot;unable to decode into struct, %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Viper uses <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/mitchellh/mapstructure">github.com/mitchellh/mapstructure - https://github.com/mitchellh/mapstructure</a> under the hood for unmarshaling values which uses mapstructure tags by default.</p>
<h3 id="Marshalling-to-string">Marshalling to string</h3>
<p>You may need to marshal all the settings held in viper into a string rather than write them to a file. You can use your favorite format’s marshaller with the config returned by <code>AllSettings()</code>.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    yaml <span class="string">&quot;gopkg.in/yaml.v2&quot;</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">yamlStringSettings</span><span class="params">()</span></span> <span class="type">string</span> &#123;</span><br><span class="line">    c := viper.AllSettings()</span><br><span class="line">    bs, err := yaml.Marshal(c)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatalf(<span class="string">&quot;unable to marshal config to YAML: %v&quot;</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">string</span>(bs)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="References">References</h2>
<p>[1] <a target="_blank" rel="noopener external nofollow noreferrer" href="https://pkg.go.dev/github.com/spf13/viper">viper · pkg.go.dev - https://pkg.go.dev/github.com/spf13/viper</a></p>
<p>[2] <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/spf13/viper">GitHub - spf13/viper: Go configuration with fangs - https://github.com/spf13/viper</a></p>
<p>[3] <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/mitchellh/mapstructure">GitHub - mitchellh/mapstructure: Go library for decoding generic map values into native Go structures and vice versa. - https://github.com/mitchellh/mapstructure</a></p>
<p>[4] <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/spf13/cobra">GitHub - spf13/cobra: A Commander for modern Go CLI interactions - https://github.com/spf13/cobra</a></p>
<p>[5] <a target="_blank" rel="noopener external nofollow noreferrer" href="https://12factor.net/">The Twelve-Factor App - https://12factor.net/</a></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>Buy me a coffee</div>
  <button>
    Donate
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/bitcoin.png" alt="CloudoLife Bitcoin">
        <span>Bitcoin</span>
      </div>

  </div>
</div>

          <div class="followme">
  <span>Welcome to my other publishing channels</span>

  <div class="social-list">

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://twitter.com/CloudoLife" rel="external nofollow noreferrer">
            <span class="icon">
              <i class="fab fa-twitter"></i>
            </span>

            <span class="label">Twitter</span>
          </a>
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://t.me/CloudoLife" rel="external nofollow noreferrer">
            <span class="icon">
              <i class="fab fa-telegram"></i>
            </span>

            <span class="label">Telegram</span>
          </a>
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/Golang-Go/" rel="tag"># Golang (Go)</a>
              <a href="/tags/etcd/" rel="tag"># etcd</a>
              <a href="/tags/Gopkg/" rel="tag"># Gopkg</a>
              <a href="/tags/Awesome-Go/" rel="tag"># Awesome Go</a>
              <a href="/tags/Configuration/" rel="tag"># Configuration</a>
              <a href="/tags/struc/" rel="tag"># struc</a>
              <a href="/tags/Marshal/" rel="tag"># Marshal</a>
              <a href="/tags/Unmarshal/" rel="tag"># Unmarshal</a>
              <a href="/tags/Viper/" rel="tag"># Viper</a>
              <a href="/tags/Configuration-File/" rel="tag"># Configuration File</a>
              <a href="/tags/Environment-Variable/" rel="tag"># Environment Variable</a>
              <a href="/tags/consul/" rel="tag"># consul</a>
              <a href="/tags/Twelve-Factor-12-Factor/" rel="tag"># Twelve-Factor / 12-Factor</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2020/03/14/Programming-Language/Golang-Go/Testing/Use-package-testing-to-test-benchmark-example-and-coverage-code-in-Golang-Go/" rel="prev" title="[Awesome Go] Use package testing to test, benchmark, example and coverage code in Golang (Go)">
                  <i class="fa fa-angle-left"></i> [Awesome Go] Use package testing to test, benchmark, example and coverage code in Golang (Go)
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2020/03/21/Programming-Language/Golang-Go/Talking-Golang-Go/Variable-Declaration-and-Initialization/" rel="next" title="[Talking-Golang (Go)] Variable Declaration and Initialization">
                  [Talking-Golang (Go)] Variable Declaration and Initialization <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments gitalk-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">CloudoLife</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="Word count total">2.6m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">39:58</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener external nofollow noreferrer" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener external nofollow noreferrer" target="_blank">NexT.Pisces</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"CloudoLife","repo":"col-hexo-CloudoLife.github.io","client_id":"4ca3ae8fb3a49237db9a","client_secret":"98d6652508799ef4350ab05aabe855e58f549112","admin_user":"benjamincloudolife","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":null,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"128175a255a2cbd96be51175d9b98398"}</script>
<script src="/js/third-party/comments/gitalk.js" defer></script>

</body>
</html>
