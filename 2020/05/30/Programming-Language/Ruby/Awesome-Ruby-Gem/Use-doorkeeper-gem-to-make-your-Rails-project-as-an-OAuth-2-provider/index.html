<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="sJgro_9-KyRL3EkTM5KW84pQPrg2Fv1KdkibDRBIulE">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"cloudolife.com","root":"/","images":"/images","scheme":"Pisces","darkmode":true,"version":"8.23.1","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null,"activeClass":"gitalk"},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="doorkeeper Doorkeeper is a gem (Rails engine) that makes it easy to introduce OAuth 2 provider functionality to your Ruby on Rails or Grape application.">
<meta property="og:type" content="article">
<meta property="og:title" content="[Awesome Ruby Gem] Use doorkeeper gem to make your Rails project as an OAuth 2 provider">
<meta property="og:url" content="https://cloudolife.com/2020/05/30/Programming-Language/Ruby/Awesome-Ruby-Gem/Use-doorkeeper-gem-to-make-your-Rails-project-as-an-OAuth-2-provider/index.html">
<meta property="og:site_name" content="Cloud-oriented Life">
<meta property="og:description" content="doorkeeper Doorkeeper is a gem (Rails engine) that makes it easy to introduce OAuth 2 provider functionality to your Ruby on Rails or Grape application.">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-05-30T00:00:00.000Z">
<meta property="article:modified_time" content="2025-06-10T09:49:34.935Z">
<meta property="article:author" content="CloudoLife">
<meta property="article:tag" content="Best Practices">
<meta property="article:tag" content="Ruby">
<meta property="article:tag" content="Programming Language">
<meta property="article:tag" content="Authentication">
<meta property="article:tag" content="Authorization">
<meta property="article:tag" content="Awesome Ruby Gem">
<meta property="article:tag" content="doorkeeper">
<meta property="article:tag" content="OAuth 2.0">
<meta property="article:tag" content="Authorization Code">
<meta property="article:tag" content="Client Credentials">
<meta property="article:tag" content="Cross Origin Resource Sharing (CROS)">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://cloudolife.com/2020/05/30/Programming-Language/Ruby/Awesome-Ruby-Gem/Use-doorkeeper-gem-to-make-your-Rails-project-as-an-OAuth-2-provider/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://cloudolife.com/2020/05/30/Programming-Language/Ruby/Awesome-Ruby-Gem/Use-doorkeeper-gem-to-make-your-Rails-project-as-an-OAuth-2-provider/","path":"2020/05/30/Programming-Language/Ruby/Awesome-Ruby-Gem/Use-doorkeeper-gem-to-make-your-Rails-project-as-an-OAuth-2-provider/","title":"[Awesome Ruby Gem] Use doorkeeper gem to make your Rails project as an OAuth 2 provider"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>[Awesome Ruby Gem] Use doorkeeper gem to make your Rails project as an OAuth 2 provider | Cloud-oriented Life</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-8Y9QPJWXQN"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-8Y9QPJWXQN","only_pageview":false,"measure_protocol_api_secret":null}</script>
  <script src="/js/third-party/analytics/google-analytics.js" defer></script>

  <script src="/js/third-party/analytics/baidu-analytics.js" defer></script>
  <script async src="https://hm.baidu.com/hm.js?995d7016a56cfd5c2ef6f2e6640a670e"></script>







  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script><script src="/js/bookmark.js" defer></script><script src="/js/pjax.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.3.1/pdfobject.min.js","integrity":"sha256-jI72I8ZLVflVOisZIOaLvRew3tyvzeu6aZXFm7P7dEo="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="/js/third-party/tags/pdf.js" defer></script>






  
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>






<script data-ad-client="ca-pub-8693122033969144" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Cloud-oriented Life" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Cloud-oriented Life</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Cloud Native Technology Improves Lives</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">1646</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">331</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">584</span></a></li><li class="menu-item menu-item-ansible"><a href="/tags/Ansible/" rel="section"><i class="fa fa-book fa-fw"></i>Ansible</a></li><li class="menu-item menu-item-awesome-software"><a href="/tags/Awesome-Software/" rel="section"><i class="fa fa-book fa-fw"></i>Awesome Software</a></li><li class="menu-item menu-item-golang-(go)"><a href="/tags/Golang-Go/" rel="section"><i class="fa fa-book fa-fw"></i>Golang (Go)</a></li><li class="menu-item menu-item-helm"><a href="/tags/Helm/" rel="section"><i class="fa fa-book fa-fw"></i>Helm</a></li><li class="menu-item menu-item-java"><a href="/tags/Java/" rel="section"><i class="fa fa-book fa-fw"></i>Java</a></li><li class="menu-item menu-item-javascript"><a href="/tags/JavaScript/" rel="section"><i class="fa fa-book fa-fw"></i>JavaScript</a></li><li class="menu-item menu-item-knative"><a href="/tags/Knative/" rel="section"><i class="fa fa-book fa-fw"></i>Knative</a></li><li class="menu-item menu-item-kubernetes-(k8s)"><a href="/tags/Kubernetes-K8S/" rel="section"><i class="fa fa-book fa-fw"></i>Kubernetes (K8S)</a></li><li class="menu-item menu-item-macos"><a href="/tags/macOS/" rel="section"><i class="fa fa-book fa-fw"></i>macOS</a></li><li class="menu-item menu-item-python"><a href="/tags/Python/" rel="section"><i class="fa fa-book fa-fw"></i>Python</a></li><li class="menu-item menu-item-pulumi"><a href="/tags/Pulumi/" rel="section"><i class="fa fa-book fa-fw"></i>Pulumi</a></li><li class="menu-item menu-item-react"><a href="/tags/React/" rel="section"><i class="fa fa-book fa-fw"></i>React</a></li><li class="menu-item menu-item-ruby"><a href="/tags/Ruby/" rel="section"><i class="fa fa-book fa-fw"></i>Ruby</a></li><li class="menu-item menu-item-ruby-on-rails"><a href="/tags/Ruby-on-Rails-RoR/" rel="section"><i class="fa fa-book fa-fw"></i>Ruby On Rails</a></li><li class="menu-item menu-item-rust"><a href="/tags/Rust/" rel="section"><i class="fa fa-book fa-fw"></i>Rust</a></li><li class="menu-item menu-item-serverless"><a href="/tags/Serverless/" rel="section"><i class="fa fa-book fa-fw"></i>Serverless</a></li><li class="menu-item menu-item-service-mesh"><a href="/tags/Service-Mesh/" rel="section"><i class="fa fa-book fa-fw"></i>Service Mesh</a></li><li class="menu-item menu-item-svelte"><a href="/tags/Svelte/" rel="section"><i class="fa fa-book fa-fw"></i>Svelte</a></li><li class="menu-item menu-item-taro"><a href="/tags/Taro/" rel="section"><i class="fa fa-book fa-fw"></i>Taro</a></li><li class="menu-item menu-item-terraform"><a href="/tags/Terraform/" rel="section"><i class="fa fa-book fa-fw"></i>Terraform</a></li><li class="menu-item menu-item-typescript"><a href="/tags/TypeScript/" rel="section"><i class="fa fa-book fa-fw"></i>TypeScript</a></li><li class="menu-item menu-item-about"><a href="/about-us/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>Sitemap</a></li><li class="menu-item menu-item-rss"><a href="/atom.xml" rel="section"><i class="fa fa-rss fa-fw"></i>RSS</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="Searching..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">1.</span> <span class="nav-text">doorkeeper</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Installation"><span class="nav-number">1.1.</span> <span class="nav-text">Installation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Usage"><span class="nav-number">1.2.</span> <span class="nav-text">Usage</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Generator"><span class="nav-number">1.2.1.</span> <span class="nav-text">Generator</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Migrations"><span class="nav-number">1.2.2.</span> <span class="nav-text">Migrations</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Integrating-with-existing-User-Model"><span class="nav-number">1.2.3.</span> <span class="nav-text">Integrating with existing User Model</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Routes"><span class="nav-number">1.2.4.</span> <span class="nav-text">Routes</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Configuration"><span class="nav-number">1.2.5.</span> <span class="nav-text">Configuration</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Resource-Owner-Authentication"><span class="nav-number">1.2.5.1.</span> <span class="nav-text">Resource Owner Authentication</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Application-Management-Authentication"><span class="nav-number">1.2.5.2.</span> <span class="nav-text">Application Management Authentication</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Scopes"><span class="nav-number">1.2.6.</span> <span class="nav-text">Scopes</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Doorkeeper-Application"><span class="nav-number">1.2.7.</span> <span class="nav-text">Doorkeeper::Application</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Securing-the-API"><span class="nav-number">1.2.8.</span> <span class="nav-text">Securing the API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Authenticated-resource-owner"><span class="nav-number">1.2.9.</span> <span class="nav-text">Authenticated resource owner</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#API-Mode"><span class="nav-number">1.2.10.</span> <span class="nav-text">API Mode</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Authorization-Code-Flow"><span class="nav-number">1.2.11.</span> <span class="nav-text">Authorization Code Flow</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Registering-the-client"><span class="nav-number">1.2.11.1.</span> <span class="nav-text">Registering the client</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Requesting-authorization"><span class="nav-number">1.2.11.2.</span> <span class="nav-text">Requesting authorization</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Requesting-the-access-token"><span class="nav-number">1.2.11.3.</span> <span class="nav-text">Requesting the access token</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Client-Credentials-flow"><span class="nav-number">1.2.12.</span> <span class="nav-text">Client Credentials flow</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Enabling-the-grant-flow"><span class="nav-number">1.2.12.1.</span> <span class="nav-text">Enabling the grant flow</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Usage-2"><span class="nav-number">1.2.12.2.</span> <span class="nav-text">Usage</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#References"><span class="nav-number">1.3.</span> <span class="nav-text">References</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">CloudoLife</p>
  <div class="site-description" itemprop="description">A Husband and Father, Knowledge Worker, Full-skilled Cloud Engineer</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">584</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">331</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">1646</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/CloudoLife" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;CloudoLife" rel="noopener me external nofollow noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/CloudoLife" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;CloudoLife" rel="noopener me external nofollow noreferrer" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          Links
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <a href="https://cloudolife.cn/" title="https:&#x2F;&#x2F;cloudolife.cn" rel="noopener external nofollow noreferrer" target="_blank">CLoudoLife - Chinese (Simplified)</a>
            </li>
        </ul>
      </div>
    </div>
        <div class="pjax">
        </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://cloudolife.com/2020/05/30/Programming-Language/Ruby/Awesome-Ruby-Gem/Use-doorkeeper-gem-to-make-your-Rails-project-as-an-OAuth-2-provider/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CloudoLife">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cloud-oriented Life">
      <meta itemprop="description" content="A Husband and Father, Knowledge Worker, Full-skilled Cloud Engineer">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="[Awesome Ruby Gem] Use doorkeeper gem to make your Rails project as an OAuth 2 provider | Cloud-oriented Life">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          [Awesome Ruby Gem] Use doorkeeper gem to make your Rails project as an OAuth 2 provider
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-05-30 00:00:00" itemprop="dateCreated datePublished" datetime="2020-05-30T00:00:00+00:00">2020-05-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-06-10 09:49:34" itemprop="dateModified" datetime="2025-06-10T09:49:34+00:00">2025-06-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming-Language/" itemprop="url" rel="index"><span itemprop="name">Programming Language</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming-Language/Ruby/" itemprop="url" rel="index"><span itemprop="name">Ruby</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming-Language/Ruby/Awesome-Ruby-Gem/" itemprop="url" rel="index"><span itemprop="name">Awesome Ruby Gem</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>13k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>12 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1>doorkeeper</h1>
<p>Doorkeeper is a gem (Rails engine) that makes it easy to introduce OAuth 2 provider functionality to your Ruby on Rails or Grape application.</p>
<span id="more"></span>
<p>Supported features:</p>
<ul>
<li>
<p>The OAuth 2.0 Authorization Framework</p>
<ul>
<li>
<p>Authorization Code Flow</p>
</li>
<li>
<p>Access Token Scopes</p>
</li>
<li>
<p>Refresh token</p>
</li>
<li>
<p>Implicit grant</p>
</li>
<li>
<p>Resource Owner Password Credentials</p>
</li>
<li>
<p>Client Credentials</p>
</li>
</ul>
</li>
<li>
<p>OAuth 2.0 Token Revocation</p>
</li>
<li>
<p>OAuth 2.0 Token Introspection</p>
</li>
<li>
<p>OAuth 2.0 Threat Model and Security Considerations</p>
</li>
<li>
<p>OAuth 2.0 for Native Apps</p>
</li>
<li>
<p>Proof Key for Code Exchange by OAuth Public Clients</p>
</li>
</ul>
<h2 id="Installation">Installation</h2>
<p>You can install it as a gem:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">gem install doorkeeper</span></span><br></pre></td></tr></table></figure>
<p>or add it into a Gemfile (Bundler):</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Gemfile</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># GitHub - doorkeeper-gem/doorkeeper: Doorkeeper is an OAuth 2 provider for Ruby on Rails / Grape.</span></span><br><span class="line"><span class="comment"># https://github.com/doorkeeper-gem/doorkeeper</span></span><br><span class="line">gem <span class="string">&#x27;doorkeeper&#x27;</span>, <span class="string">`5.5.0&#x27;</span></span><br></pre></td></tr></table></figure>
<p>Then, run <code>bundle install</code>.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">bundle install</span></span><br></pre></td></tr></table></figure>
<h2 id="Usage">Usage</h2>
<h3 id="Generator">Generator</h3>
<p>After that, you need to generate relevant files with:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">bundle <span class="built_in">exec</span> rails generate doorkeeper:install</span></span><br></pre></td></tr></table></figure>
<p>This will introduce three changes:</p>
<ul>
<li>
<p>A new initializer in <code>config/initializers/doorkeeper.rb</code></p>
</li>
<li>
<p>Add doorkeeper’s routes to <code>config/routes.rb</code></p>
</li>
<li>
<p>Locale files in <code>config/locales/doorkeeper.en.yml</code></p>
</li>
</ul>
<h3 id="Migrations">Migrations</h3>
<p>To generate appropriate tables, run:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">bundle <span class="built_in">exec</span> rails generate doorkeeper:migration</span></span><br><span class="line">    create  db/migrate/20190324080634_create_doorkeeper_tables.rb</span><br></pre></td></tr></table></figure>
<p>This migration will create all necessary tables for <a target="_blank" rel="noopener external nofollow noreferrer" href="https://doorkeeper.gitbook.io/guides/concepts/application">oAuth2 Applications - https://doorkeeper.gitbook.io/guides/concepts/application</a>, <a target="_blank" rel="noopener external nofollow noreferrer" href="https://doorkeeper.gitbook.io/guides/concepts/access-grant">Access Grants - https://doorkeeper.gitbook.io/guides/concepts/access-grant</a>, and <a target="_blank" rel="noopener external nofollow noreferrer" href="https://doorkeeper.gitbook.io/guides/concepts/access-token">Access Tokens - https://doorkeeper.gitbook.io/guides/concepts/access-token</a>. See the <a target="_blank" rel="noopener external nofollow noreferrer" href="https://doorkeeper.gitbook.io/guides/internals/database-design">database design - https://doorkeeper.gitbook.io/guides/internals/database-design</a> for more details.</p>
<hr>
<p>NOTE: If using UUIDs instead of integer IDs, see Using <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/doorkeeper-gem/doorkeeper/wiki/Using-PostgreSQL-UUIDs-as-primary-keys-with-Doorkeeper">PostgreSQL UUIDs as primary keys with Doorkeeper - https://github.com/doorkeeper-gem/doorkeeper/wiki/Using-PostgreSQL-UUIDs-as-primary-keys-with-Doorkeeper</a> for changes you will need to make to your migration.</p>
<hr>
<h3 id="Integrating-with-existing-User-Model">Integrating with existing User Model</h3>
<p>Before executing the migration, you may want to add foreign keys to doorkeeper’s tables to ensure data integrity. Go to the migration file and uncomment the lines below:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># db/migrate/20190324080634_create_doorkeeper_tables.rb</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Uncomment below to ensure a valid reference to the resource owner&#x27;s table</span></span><br><span class="line">add_foreign_key <span class="symbol">:oauth_access_grants</span>, <span class="symbol">:users</span>, <span class="symbol">column:</span> <span class="symbol">:resource_owner_id</span></span><br><span class="line">add_foreign_key <span class="symbol">:oauth_access_tokens</span>, <span class="symbol">:users</span>, <span class="symbol">column:</span> <span class="symbol">:resource_owner_id</span></span><br></pre></td></tr></table></figure>
<p>Now you’re ready to run the migrations:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bundle exec rake db:migrate</span><br></pre></td></tr></table></figure>
<p>As the next step, you may want to add associations to your model. If you skip this step, you’ll encounter <code>ActiveRecord::InvalidForeignKeyerror</code> when you try to destroy the User that has associated access grants or access tokens.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># app/models/user.rb</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span> &lt; <span class="title class_ inherited__">ApplicationRecord</span></span><br><span class="line">  has_many <span class="symbol">:access_grants</span>,</span><br><span class="line">           <span class="symbol">class_name:</span> <span class="string">&#x27;Doorkeeper::AccessGrant&#x27;</span>,</span><br><span class="line">           <span class="symbol">foreign_key:</span> <span class="symbol">:resource_owner_id</span>,</span><br><span class="line">           <span class="symbol">dependent:</span> <span class="symbol">:delete_all</span> <span class="comment"># or :destroy if you need callbacks</span></span><br><span class="line"></span><br><span class="line">  has_many <span class="symbol">:access_tokens</span>,</span><br><span class="line">           <span class="symbol">class_name:</span> <span class="string">&#x27;Doorkeeper::AccessToken&#x27;</span>,</span><br><span class="line">           <span class="symbol">foreign_key:</span> <span class="symbol">:resource_owner_id</span>,</span><br><span class="line">           <span class="symbol">dependent:</span> <span class="symbol">:delete_all</span> <span class="comment"># or :destroy if you need callbacks</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h3 id="Routes">Routes</h3>
<p>The installation script will also automatically add the Doorkeeper routes into your app:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">config/routes.rb</span><br><span class="line"><span class="title class_">Rails</span>.application.routes.draw <span class="keyword">do</span></span><br><span class="line">  use_doorkeeper</span><br><span class="line">  <span class="comment"># your routes below</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>This will mount following routes:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">bundle <span class="built_in">exec</span> rails routes</span></span><br><span class="line">   native_oauth_authorization GET    /oauth/authorize/native(.:format)             doorkeeper/authorizations#show</span><br><span class="line">          oauth_authorization GET    /oauth/authorize(.:format)                    doorkeeper/authorizations#new</span><br><span class="line">                              DELETE /oauth/authorize(.:format)                    doorkeeper/authorizations#destroy</span><br><span class="line">                              POST   /oauth/authorize(.:format)                    doorkeeper/authorizations#create</span><br><span class="line">                  oauth_token POST   /oauth/token(.:format)                        doorkeeper/tokens#create</span><br><span class="line">                 oauth_revoke POST   /oauth/revoke(.:format)                       doorkeeper/tokens#revoke</span><br><span class="line">             oauth_introspect POST   /oauth/introspect(.:format)                   doorkeeper/tokens#introspect</span><br><span class="line">           oauth_applications GET    /oauth/applications(.:format)                 doorkeeper/applications#index</span><br><span class="line">                              POST   /oauth/applications(.:format)                 doorkeeper/applications#create</span><br><span class="line">        new_oauth_application GET    /oauth/applications/new(.:format)             doorkeeper/applications#new</span><br><span class="line">       edit_oauth_application GET    /oauth/applications/:id/edit(.:format)        doorkeeper/applications#edit</span><br><span class="line">            oauth_application GET    /oauth/applications/:id(.:format)             doorkeeper/applications#show</span><br><span class="line">                              PATCH  /oauth/applications/:id(.:format)             doorkeeper/applications#update</span><br><span class="line">                              PUT    /oauth/applications/:id(.:format)             doorkeeper/applications#update</span><br><span class="line">                              DELETE /oauth/applications/:id(.:format)             doorkeeper/applications#destroy</span><br><span class="line">oauth_authorized_applications GET    /oauth/authorized_applications(.:format)      doorkeeper/authorized_applications#index</span><br><span class="line"> oauth_authorized_application DELETE /oauth/authorized_applications/:id(.:format)  doorkeeper/authorized_applications#destroy</span><br><span class="line">             oauth_token_info GET    /oauth/token/info(.:format)                   doorkeeper/token_info#show</span><br></pre></td></tr></table></figure>
<p>At this point on the guide, we’re not going to change the routes. For more information on how to customize them, check out this page on the <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/doorkeeper-gem/doorkeeper/wiki/Customizing-routes">wiki - https://github.com/doorkeeper-gem/doorkeeper/wiki/Customizing-routes</a>.</p>
<h3 id="Configuration">Configuration</h3>
<p>Before you’re able to use Doorkeeper, you need to configure how resource owners (users) can be authenticated and who can manage such applications.</p>
<h4 id="Resource-Owner-Authentication">Resource Owner Authentication</h4>
<p>This configuration should do two things:</p>
<ul>
<li>
<p>Return the user is currently authenticated</p>
</li>
<li>
<p>Redirect the user to the authentication page</p>
</li>
</ul>
<p>If you’re using devise, one option is to write the following:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config/initializers/doorkeeper.rb</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Doorkeeper</span>.configure <span class="keyword">do</span></span><br><span class="line">  resource_owner_authenticator <span class="keyword">do</span></span><br><span class="line">    current_user |<span class="params"></span>| warden.authenticate!(<span class="symbol">scope:</span> <span class="symbol">:user</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>The block above runs in the context of your application so you have access to your models, session and routes helpers. However, it is not run in the context of the ApplicationController which means that it doesn’t have access to the methods defined over there.</p>
<p>You may want to check other ways of <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/doorkeeper-gem/doorkeeper/wiki/Authenticating-using-Clearance-or-DIY">authentication - https://github.com/doorkeeper-gem/doorkeeper/wiki/Authenticating-using-Clearance-or-DIY</a> here.</p>
<h4 id="Application-Management-Authentication">Application Management Authentication</h4>
<p>By default, the applications list in <code>/oauth/applications</code> is unavailable. To let users see and manage all applications, you should configure <code>admin_authenticator</code> block:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">config/initializers/doorkeeper.rb</span><br><span class="line"><span class="title class_">Doorkeeper</span>.configure <span class="keyword">do</span></span><br><span class="line">  admin_authenticator <span class="keyword">do</span> |<span class="params">_routes</span>|</span><br><span class="line">    current_user |<span class="params"></span>| warden.authenticate!(<span class="symbol">scope:</span> <span class="symbol">:user</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>The block follows the same rules as <code>resource_owner_authenticator</code> block.</p>
<hr>
<p>Note: the application list is just a scaffold. It’s highly recommended to either customize the controller used by the list or skip the controller all together. For more information see the page in the <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/doorkeeper-gem/doorkeeper/wiki/Customizing-routes">wiki - https://github.com/doorkeeper-gem/doorkeeper/wiki/Customizing-routes</a>.</p>
<hr>
<h3 id="Scopes">Scopes</h3>
<p>For this guide let’s create two scopes: read and write. Applications authorized with the read scope will be able to read public data from our API. The write scope will let applications change data in our API.</p>
<p>Go to doorkeeper’s initializer and add:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config/initializers/doorkeeper.rb</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Doorkeeper</span>.configure <span class="keyword">do</span></span><br><span class="line">  default_scopes <span class="symbol">:read</span></span><br><span class="line">  optional_scopes <span class="symbol">:write</span></span><br><span class="line">    </span><br><span class="line">  enforce_configured_scopes</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>The last line with <code>enforce_configured_scopes</code> ensures applications to be able to ask only for configured scopes defined in <code>default_scopes</code> and <code>optional_scopes</code>.</p>
<h3 id="Doorkeeper-Application">Doorkeeper::Application</h3>
<p>In order to add Applications for authorizing, you will need to create them via console:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Doorkeeper</span><span class="symbol">:</span><span class="symbol">:Application</span>.create(<span class="symbol">name:</span> <span class="string">&quot;MyApp&quot;</span>, <span class="symbol">redirect_uri:</span> <span class="string">&quot;urn:ietf:wg:oauth:2.0:oob&quot;</span>, <span class="symbol">scopes:</span> [<span class="string">&quot;read&quot;</span>, <span class="string">&quot;write&quot;</span>])</span><br></pre></td></tr></table></figure>
<h3 id="Securing-the-API">Securing the API</h3>
<p>To protect your controllers (usual one or <code>ActionController::API</code>) with OAuth, you just need to setup <code>before_actions</code> specifying the actions you want to protect. For example:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Api::V1::ProductsController</span> &lt; <span class="title class_ inherited__">Api::V1::ApiController</span></span><br><span class="line">  before_action <span class="symbol">:doorkeeper_authorize!</span> <span class="comment"># Requires access token for all actions</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># before_action -&gt; &#123; doorkeeper_authorize! :read, :write &#125;</span></span><br><span class="line">​</span><br><span class="line">  <span class="comment"># your actions</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>You can pass any option before_action accepts, such as <code>if</code>, <code>only</code>, <code>except</code>, and others.</p>
<h3 id="Authenticated-resource-owner">Authenticated resource owner</h3>
<p>If you want to return data based on the current resource owner, in other words, the access token owner, you may want to define a method in your controller that returns the resource owner instance:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Api::V1::CredentialsController</span> &lt; <span class="title class_ inherited__">Api::V1::ApiController</span></span><br><span class="line">  before_action <span class="symbol">:doorkeeper_authorize!</span></span><br><span class="line">  respond_to    <span class="symbol">:json</span></span><br><span class="line">​</span><br><span class="line">  <span class="comment"># GET /me.json</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">me</span></span><br><span class="line">    respond_with current_resource_owner</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">​</span><br><span class="line">  <span class="keyword">private</span></span><br><span class="line">​</span><br><span class="line">  <span class="comment"># Find the user that owns the access token</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">current_resource_owner</span></span><br><span class="line">    <span class="title class_">User</span>.find(doorkeeper_token.resource_owner_id) <span class="keyword">if</span> doorkeeper_token</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>In this example, we’re returning the credentials (me.json) of the access token owner.</p>
<h3 id="API-Mode">API Mode</h3>
<p>By default Doorkeeper uses full Rails stack to provide all the OAuth 2 functionality with additional features like administration area for managing applications. By the way, starting from Doorkeeper 5 you can use API mode for your API only Rails 5 applications. All you need is just to configure the gem to work in desired mode:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">config/initializers/doorkeeper.rb</span><br><span class="line"><span class="title class_">Doorkeeper</span>.configure <span class="keyword">do</span></span><br><span class="line">  api_only</span><br><span class="line">  base_controller <span class="string">&#x27;ActionController::API&#x27;</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>Keep in mind, that in this mode you will not be able to access Applications or Authorized Applications controllers because they will be skipped. CSRF protections (which are otherwise enabled) will be skipped, and all the redirects will be returned as JSON response with corresponding locations.</p>
<h3 id="Authorization-Code-Flow">Authorization Code Flow</h3>
<p>Authorization code is probably the most used flow. It basically consists of an exchange of an authorization token for an access token. For more detailed info, check out the RFC spec here</p>
<p>The first step is to register your client app.</p>
<h4 id="Registering-the-client">Registering the client</h4>
<p>Once you have doorkeeper up and running, set up a new client in <code>/oauth/applications/new</code>. For testing purposes, you should fill in the redirect URI field with <code>urn:ietf:wg:oauth:2.0:oob</code>. This will tell doorkeeper to display the authorization code instead of redirecting to a client application (that you don’t have now).</p>
<p>You can change this behaviour by changing the <code>native_redirect_uri</code> config in the doorkeeper initializer.</p>
<h4 id="Requesting-authorization">Requesting authorization</h4>
<p>To request the authorization token, you should visit the <code>/oauth/authorize</code> endpoint. You can do that either by clicking in the link to the authorization page in the app details or by visiting manually the URL:</p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="http://localhost:3000/oauth/authorize?client_id=YOUR_CLIENT_ID&amp;redirect_uri=urn:ietf:wg:oauth:2.0:oob&amp;response_type=code">http://localhost:3000/oauth/authorize?client_id=YOUR_CLIENT_ID&amp;redirect_uri=urn:ietf:wg:oauth:2.0:oob&amp;response_type=code</a></p>
<p>Once you are there, you should sign in and click on Authorize and Access grant.</p>
<h4 id="Requesting-the-access-token">Requesting the access token</h4>
<p>To request the access token, you should use the returned code and exchange it for an access token. To do that you can use any HTTP client. In this case, I used rest-client:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">parameters = <span class="string">&#x27;client_id=THE_ID&amp;client_secret=THE_SECRET&amp;code=RETURNED_CODE&amp;grant_type=authorization_code&amp;redirect_uri=urn:ietf:wg:oauth:2.0:oob&#x27;</span></span><br><span class="line"><span class="title class_">RestClient</span>.post <span class="string">&#x27;http://localhost:3000/oauth/token&#x27;</span>, parameters</span><br><span class="line"></span><br><span class="line"><span class="comment"># The response will be</span></span><br><span class="line">&#123;</span><br><span class="line"> <span class="string">&quot;access_token&quot;</span>: <span class="string">&quot;de6780bc506a0446309bd9362820ba8aed28aa506c71eedbe1c5c4f9dd350e54&quot;</span>,</span><br><span class="line"> <span class="string">&quot;token_type&quot;</span>: <span class="string">&quot;Bearer&quot;</span>, </span><br><span class="line"> <span class="string">&quot;expires_in&quot;</span>: <span class="number">7200</span>,</span><br><span class="line"> <span class="string">&quot;refresh_token&quot;</span>: <span class="string">&quot;8257e65c97202ed1726cf9571600918f3bffb2544b26e00a61df9897668c33a1&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>You can now make requests to the API with the access token returned.</p>
<h3 id="Client-Credentials-flow">Client Credentials flow</h3>
<p>The Client Credentials flow is probably the most simple flow of OAuth 2 flows. The main difference from the others is that this flow is not associated with a resource owner.</p>
<p>One usage of this flow would be retrieving client statistics for example. Since the access token would be connected to the client only, the access token won’t have access to private user data for example.</p>
<h4 id="Enabling-the-grant-flow">Enabling the grant flow</h4>
<p>In your Doorkeeper configuration initializer, have a line like this:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># add other flows to this array if you want more to be enabled, e.g., %w&#123;authorization_code implicit password&#125;</span></span><br><span class="line">grant_flows [<span class="string">&#x27;client_credentials&#x27;</span>]</span><br></pre></td></tr></table></figure>
<h4 id="Usage-2">Usage</h4>
<p>To get an access token from client credentials flow, you have to do a post to <code>/oauth/token</code> endpoint:</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST /oauth/token</span><br><span class="line"><span class="attribute">Authorization</span><span class="punctuation">: </span>Basic czZCaGRSa3F0MzpnWDFmQmF0M2JW</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded;charset=UTF-8</span><br><span class="line">grant_type=client_credentials</span><br></pre></td></tr></table></figure>
<p>The Authorization header includes the encoded credentials for the client. For more information and options on how authenticate clients, check this page in the wiki.</p>
<p>In ruby, it would be something like this:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">&#x27;rest-client&#x27;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;json&#x27;</span></span><br><span class="line"></span><br><span class="line">client_id = <span class="string">&#x27;4ea1b...&#x27;</span></span><br><span class="line">client_secret = <span class="string">&#x27;a2982...&#x27;</span></span><br><span class="line"></span><br><span class="line">response = <span class="title class_">RestClient</span>.post <span class="string">&#x27;http://localhost:3000/oauth/token&#x27;</span>, &#123;</span><br><span class="line">  <span class="symbol">grant_type:</span> <span class="string">&#x27;client_credentials&#x27;</span>,</span><br><span class="line">  <span class="symbol">client_id:</span> client_id,</span><br><span class="line">  <span class="symbol">client_secret:</span> client_secret</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Notice that in this case we used client_id/secret on parameters instead of using the encoded header.</p>
<p>After that you’ll have the access token in the response:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">token = <span class="variable constant_">JSON</span>.parse(response)[<span class="string">&quot;access_token&quot;</span>]</span><br><span class="line"><span class="comment"># =&gt; &#x27;a2982...&#x27;</span></span><br></pre></td></tr></table></figure>
<p>And then, you can request access to protected resources that do not require a resource owner:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">RestClient</span>.get <span class="string">&#x27;http://localhost:3000/api/v1/profiles.json&#x27;</span>, &#123; <span class="string">&#x27;Authorization&#x27;</span> =&gt; <span class="string">&quot;Bearer <span class="subst">#&#123;token&#125;</span>&quot;</span> &#125;</span><br><span class="line"><span class="comment"># =&gt; &quot;[&#123;&quot;email&quot;:&quot;tara_kertzmann<span class="doctag">@yundt</span>.name&quot;,&quot;id&quot;:25,&quot;name&quot;:&quot;Jorge Ward&quot;,&quot;username&quot;:&quot;leonor&quot;&#125;, ...]&quot;</span></span><br></pre></td></tr></table></figure>
<p>That’s everything.</p>
<h2 id="References">References</h2>
<p>[1] <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/doorkeeper-gem/doorkeeper">GitHub - doorkeeper-gem/doorkeeper: Doorkeeper is an OAuth 2 provider for Ruby on Rails / Grape. - https://github.com/doorkeeper-gem/doorkeeper</a></p>
<p>[2] <a target="_blank" rel="noopener external nofollow noreferrer" href="https://doorkeeper.gitbook.io/guides/">Doorkeeper Guides - doorkeeper - https://doorkeeper.gitbook.io/guides/</a></p>
<p>[3] <a target="_blank" rel="noopener external nofollow noreferrer" href="https://rubygems.org/gems/doorkeeper/">doorkeeper | RubyGems.org | your community gem host - https://rubygems.org/gems/doorkeeper/</a></p>
<p>[4] <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/doorkeeper-gem/doorkeeper/wiki/Authorization-Code-Flow">Authorization Code Flow · doorkeeper-gem/doorkeeper Wiki · GitHub - https://github.com/doorkeeper-gem/doorkeeper/wiki/Authorization-Code-Flow</a></p>
<p>[5] <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/doorkeeper-gem/doorkeeper/wiki/Client-Credentials-flow">Client Credentials flow · doorkeeper-gem/doorkeeper Wiki · GitHub - https://github.com/doorkeeper-gem/doorkeeper/wiki/Client-Credentials-flow</a></p>
<p>[6] <a target="_blank" rel="noopener external nofollow noreferrer" href="https://oauth.net/2/">OAuth 2.0 — OAuth - https://oauth.net/2/</a></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>Buy me a coffee</div>
  <button>
    Donate
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/bitcoin.png" alt="CloudoLife Bitcoin">
        <span>Bitcoin</span>
      </div>

  </div>
</div>

          <div class="followme">
  <span>Welcome to my other publishing channels</span>

  <div class="social-list">

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://twitter.com/CloudoLife" rel="external nofollow noreferrer">
            <span class="icon">
              <i class="fab fa-twitter"></i>
            </span>

            <span class="label">Twitter</span>
          </a>
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://t.me/CloudoLife" rel="external nofollow noreferrer">
            <span class="icon">
              <i class="fab fa-telegram"></i>
            </span>

            <span class="label">Telegram</span>
          </a>
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/Best-Practices/" rel="tag"># Best Practices</a>
              <a href="/tags/Ruby/" rel="tag"># Ruby</a>
              <a href="/tags/Programming-Language/" rel="tag"># Programming Language</a>
              <a href="/tags/Authentication/" rel="tag"># Authentication</a>
              <a href="/tags/Authorization/" rel="tag"># Authorization</a>
              <a href="/tags/Awesome-Ruby-Gem/" rel="tag"># Awesome Ruby Gem</a>
              <a href="/tags/doorkeeper/" rel="tag"># doorkeeper</a>
              <a href="/tags/OAuth-2-0/" rel="tag"># OAuth 2.0</a>
              <a href="/tags/Authorization-Code/" rel="tag"># Authorization Code</a>
              <a href="/tags/Client-Credentials/" rel="tag"># Client Credentials</a>
              <a href="/tags/Cross-Origin-Resource-Sharing-CROS/" rel="tag"># Cross Origin Resource Sharing (CROS)</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2020/05/30/Programming-Language/Ruby/Ruby-on-Rails-RoR/Best-practices-about-Rails-Console/" rel="prev" title="[Ruby on Rails (RoR)] Best practices about Rails Console">
                  <i class="fa fa-angle-left"></i> [Ruby on Rails (RoR)] Best practices about Rails Console
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2020/05/30/Programming-Language/Golang-Go/Awesome-Go/Use-logrus_mate-package-to-initiate-Logrus-logger/" rel="next" title="[Awesome Go] Use logrus_mate package to initiate Logrus logger">
                  [Awesome Go] Use logrus_mate package to initiate Logrus logger <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments gitalk-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">CloudoLife</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="Word count total">2.6m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">39:58</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener external nofollow noreferrer" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener external nofollow noreferrer" target="_blank">NexT.Pisces</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"CloudoLife","repo":"col-hexo-CloudoLife.github.io","client_id":"4ca3ae8fb3a49237db9a","client_secret":"98d6652508799ef4350ab05aabe855e58f549112","admin_user":"benjamincloudolife","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":null,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"764aa4f5c9925c9950676272044b8057"}</script>
<script src="/js/third-party/comments/gitalk.js" defer></script>

</body>
</html>
