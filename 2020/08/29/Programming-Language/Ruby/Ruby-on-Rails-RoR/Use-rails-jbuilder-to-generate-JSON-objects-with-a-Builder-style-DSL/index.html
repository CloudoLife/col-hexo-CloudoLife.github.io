<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="sJgro_9-KyRL3EkTM5KW84pQPrg2Fv1KdkibDRBIulE">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"cloudolife.com","root":"/","images":"/images","scheme":"Pisces","darkmode":true,"version":"8.23.1","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null,"activeClass":"gitalk"},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="jbuilder Jbuilder gives you a simple DSL for declaring JSON structures that beats manipulating giant hash structures. This is particularly helpful when the generation process is fraught with condition">
<meta property="og:type" content="article">
<meta property="og:title" content="[Ruby on Rails (RoR)] Use rails jbuilder to generate JSON objects with a Builder-style DSL ">
<meta property="og:url" content="https://cloudolife.com/2020/08/29/Programming-Language/Ruby/Ruby-on-Rails-RoR/Use-rails-jbuilder-to-generate-JSON-objects-with-a-Builder-style-DSL/index.html">
<meta property="og:site_name" content="Cloud-oriented Life">
<meta property="og:description" content="jbuilder Jbuilder gives you a simple DSL for declaring JSON structures that beats manipulating giant hash structures. This is particularly helpful when the generation process is fraught with condition">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-08-29T00:00:00.000Z">
<meta property="article:modified_time" content="2025-06-10T09:49:34.941Z">
<meta property="article:author" content="CloudoLife">
<meta property="article:tag" content="Rails &#x2F; Ruby on Rails (RoR)">
<meta property="article:tag" content="Best Practices">
<meta property="article:tag" content="Ruby">
<meta property="article:tag" content="Programming Language">
<meta property="article:tag" content="JavaScript Object Notation (JSON)">
<meta property="article:tag" content="JSON">
<meta property="article:tag" content="RESTful">
<meta property="article:tag" content="Representational State Transfer">
<meta property="article:tag" content="Awesome Ruby Gem">
<meta property="article:tag" content="jbuilder">
<meta property="article:tag" content="json.jbuilder">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://cloudolife.com/2020/08/29/Programming-Language/Ruby/Ruby-on-Rails-RoR/Use-rails-jbuilder-to-generate-JSON-objects-with-a-Builder-style-DSL/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://cloudolife.com/2020/08/29/Programming-Language/Ruby/Ruby-on-Rails-RoR/Use-rails-jbuilder-to-generate-JSON-objects-with-a-Builder-style-DSL/","path":"2020/08/29/Programming-Language/Ruby/Ruby-on-Rails-RoR/Use-rails-jbuilder-to-generate-JSON-objects-with-a-Builder-style-DSL/","title":"[Ruby on Rails (RoR)] Use rails jbuilder to generate JSON objects with a Builder-style DSL "}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>[Ruby on Rails (RoR)] Use rails jbuilder to generate JSON objects with a Builder-style DSL  | Cloud-oriented Life</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-8Y9QPJWXQN"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-8Y9QPJWXQN","only_pageview":false,"measure_protocol_api_secret":null}</script>
  <script src="/js/third-party/analytics/google-analytics.js" defer></script>

  <script src="/js/third-party/analytics/baidu-analytics.js" defer></script>
  <script async src="https://hm.baidu.com/hm.js?995d7016a56cfd5c2ef6f2e6640a670e"></script>







  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script><script src="/js/bookmark.js" defer></script><script src="/js/pjax.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.3.1/pdfobject.min.js","integrity":"sha256-jI72I8ZLVflVOisZIOaLvRew3tyvzeu6aZXFm7P7dEo="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="/js/third-party/tags/pdf.js" defer></script>






  
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>






<script data-ad-client="ca-pub-8693122033969144" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Cloud-oriented Life" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Cloud-oriented Life</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Cloud Native Technology Improves Lives</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">1646</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">331</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">584</span></a></li><li class="menu-item menu-item-ansible"><a href="/tags/Ansible/" rel="section"><i class="fa fa-book fa-fw"></i>Ansible</a></li><li class="menu-item menu-item-awesome-software"><a href="/tags/Awesome-Software/" rel="section"><i class="fa fa-book fa-fw"></i>Awesome Software</a></li><li class="menu-item menu-item-golang-(go)"><a href="/tags/Golang-Go/" rel="section"><i class="fa fa-book fa-fw"></i>Golang (Go)</a></li><li class="menu-item menu-item-helm"><a href="/tags/Helm/" rel="section"><i class="fa fa-book fa-fw"></i>Helm</a></li><li class="menu-item menu-item-java"><a href="/tags/Java/" rel="section"><i class="fa fa-book fa-fw"></i>Java</a></li><li class="menu-item menu-item-javascript"><a href="/tags/JavaScript/" rel="section"><i class="fa fa-book fa-fw"></i>JavaScript</a></li><li class="menu-item menu-item-knative"><a href="/tags/Knative/" rel="section"><i class="fa fa-book fa-fw"></i>Knative</a></li><li class="menu-item menu-item-kubernetes-(k8s)"><a href="/tags/Kubernetes-K8S/" rel="section"><i class="fa fa-book fa-fw"></i>Kubernetes (K8S)</a></li><li class="menu-item menu-item-macos"><a href="/tags/macOS/" rel="section"><i class="fa fa-book fa-fw"></i>macOS</a></li><li class="menu-item menu-item-python"><a href="/tags/Python/" rel="section"><i class="fa fa-book fa-fw"></i>Python</a></li><li class="menu-item menu-item-pulumi"><a href="/tags/Pulumi/" rel="section"><i class="fa fa-book fa-fw"></i>Pulumi</a></li><li class="menu-item menu-item-react"><a href="/tags/React/" rel="section"><i class="fa fa-book fa-fw"></i>React</a></li><li class="menu-item menu-item-ruby"><a href="/tags/Ruby/" rel="section"><i class="fa fa-book fa-fw"></i>Ruby</a></li><li class="menu-item menu-item-ruby-on-rails"><a href="/tags/Ruby-on-Rails-RoR/" rel="section"><i class="fa fa-book fa-fw"></i>Ruby On Rails</a></li><li class="menu-item menu-item-rust"><a href="/tags/Rust/" rel="section"><i class="fa fa-book fa-fw"></i>Rust</a></li><li class="menu-item menu-item-serverless"><a href="/tags/Serverless/" rel="section"><i class="fa fa-book fa-fw"></i>Serverless</a></li><li class="menu-item menu-item-service-mesh"><a href="/tags/Service-Mesh/" rel="section"><i class="fa fa-book fa-fw"></i>Service Mesh</a></li><li class="menu-item menu-item-svelte"><a href="/tags/Svelte/" rel="section"><i class="fa fa-book fa-fw"></i>Svelte</a></li><li class="menu-item menu-item-taro"><a href="/tags/Taro/" rel="section"><i class="fa fa-book fa-fw"></i>Taro</a></li><li class="menu-item menu-item-terraform"><a href="/tags/Terraform/" rel="section"><i class="fa fa-book fa-fw"></i>Terraform</a></li><li class="menu-item menu-item-typescript"><a href="/tags/TypeScript/" rel="section"><i class="fa fa-book fa-fw"></i>TypeScript</a></li><li class="menu-item menu-item-about"><a href="/about-us/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>Sitemap</a></li><li class="menu-item menu-item-rss"><a href="/atom.xml" rel="section"><i class="fa fa-rss fa-fw"></i>RSS</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="Searching..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">1.</span> <span class="nav-text">jbuilder</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Example"><span class="nav-number">1.1.</span> <span class="nav-text">Example</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dynamical-Attribute"><span class="nav-number">1.2.</span> <span class="nav-text">Dynamical Attribute</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Attribute-Merge"><span class="nav-number">1.3.</span> <span class="nav-text">Attribute Merge</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Array"><span class="nav-number">1.4.</span> <span class="nav-text">Array</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Jbuilder-Object"><span class="nav-number">1.5.</span> <span class="nav-text">Jbuilder Object</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Partial-Render"><span class="nav-number">1.6.</span> <span class="nav-text">Partial Render</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Fragment-caching"><span class="nav-number">1.7.</span> <span class="nav-text">Fragment caching</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Key-Format"><span class="nav-number">1.8.</span> <span class="nav-text">Key Format</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#FAQS"><span class="nav-number">1.9.</span> <span class="nav-text">FAQS</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#return-within-block-will-cause-json-can-not-render-content-within-block"><span class="nav-number">1.9.1.</span> <span class="nav-text">return within block will cause json can not render content within block</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#References"><span class="nav-number">1.10.</span> <span class="nav-text">References</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">CloudoLife</p>
  <div class="site-description" itemprop="description">A Husband and Father, Knowledge Worker, Full-skilled Cloud Engineer</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">584</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">331</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">1646</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/CloudoLife" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;CloudoLife" rel="noopener me external nofollow noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/CloudoLife" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;CloudoLife" rel="noopener me external nofollow noreferrer" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          Links
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <a href="https://cloudolife.cn/" title="https:&#x2F;&#x2F;cloudolife.cn" rel="noopener external nofollow noreferrer" target="_blank">CLoudoLife - Chinese (Simplified)</a>
            </li>
        </ul>
      </div>
    </div>
        <div class="pjax">
        </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://cloudolife.com/2020/08/29/Programming-Language/Ruby/Ruby-on-Rails-RoR/Use-rails-jbuilder-to-generate-JSON-objects-with-a-Builder-style-DSL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CloudoLife">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cloud-oriented Life">
      <meta itemprop="description" content="A Husband and Father, Knowledge Worker, Full-skilled Cloud Engineer">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="[Ruby on Rails (RoR)] Use rails jbuilder to generate JSON objects with a Builder-style DSL  | Cloud-oriented Life">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          [Ruby on Rails (RoR)] Use rails jbuilder to generate JSON objects with a Builder-style DSL 
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-08-29 00:00:00" itemprop="dateCreated datePublished" datetime="2020-08-29T00:00:00+00:00">2020-08-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-06-10 09:49:34" itemprop="dateModified" datetime="2025-06-10T09:49:34+00:00">2025-06-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming-Language/" itemprop="url" rel="index"><span itemprop="name">Programming Language</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming-Language/Ruby/" itemprop="url" rel="index"><span itemprop="name">Ruby</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming-Language/Ruby/Rails-Ruby-on-Rails-RoR/" itemprop="url" rel="index"><span itemprop="name">Rails / Ruby on Rails (RoR)</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming-Language/Ruby/Rails-Ruby-on-Rails-RoR/Best-Practices/" itemprop="url" rel="index"><span itemprop="name">Best Practices</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>10k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>9 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1>jbuilder</h1>
<p>Jbuilder gives you a simple DSL for declaring JSON structures that beats manipulating giant hash structures. This is particularly helpful when the generation process is fraught with conditionals and loops. JSON objects can be use in RESTful API or composing objects.</p>
<span id="more"></span>
<h2 id="Example">Example</h2>
<p>Here’s a simple example:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># app/views/messages/show.json.jbuilder</span></span><br><span class="line"></span><br><span class="line">json.content format_content(<span class="variable">@message</span>.content)</span><br><span class="line"><span class="comment"># You can use the call syntax instead of an explicit extract! call:</span></span><br><span class="line">json.extract! <span class="variable">@message</span>, <span class="symbol">:created_at</span>, <span class="symbol">:updated_at</span></span><br><span class="line">json.(<span class="variable">@message</span>, <span class="symbol">:created_at</span>, <span class="symbol">:updated_at</span>)</span><br><span class="line"></span><br><span class="line">json.author <span class="keyword">do</span></span><br><span class="line">  json.name <span class="variable">@message</span>.creator.name.familiar</span><br><span class="line">  json.email_address <span class="variable">@message</span>.creator.email_address_with_name</span><br><span class="line">  json.url url_for(<span class="variable">@message</span>.creator, <span class="symbol">format:</span> <span class="symbol">:json</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> current_user.admin?</span><br><span class="line">  json.visitors calculate_visitors(<span class="variable">@message</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">json.comments <span class="variable">@message</span>.comments, <span class="symbol">:content</span>, <span class="symbol">:created_at</span></span><br><span class="line"></span><br><span class="line">json.attachments <span class="variable">@message</span>.attachments <span class="keyword">do</span> |<span class="params">attachment</span>|</span><br><span class="line">  json.filename attachment.filename</span><br><span class="line">  json.url url_for(attachment)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>This will build the following structure:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;p&gt;This is &lt;i&gt;serious&lt;/i&gt; monkey business&lt;/p&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;created_at&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2011-10-29T20:45:28-05:00&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;updated_at&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2011-10-29T20:45:28-05:00&quot;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">&quot;author&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;David H.&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;email_address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#x27;David Heinemeier Hansson&#x27; &lt;david@heinemeierhansson.com&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://example.com/users/1-david.json&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">&quot;visitors&quot;</span><span class="punctuation">:</span> <span class="number">15</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">&quot;comments&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span> <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Hello everyone!&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;created_at&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2011-10-29T20:45:28-05:00&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span> <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;To you my good sir!&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;created_at&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2011-10-29T20:47:28-05:00&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">&quot;attachments&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span> <span class="attr">&quot;filename&quot;</span><span class="punctuation">:</span> <span class="string">&quot;forecast.xls&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://example.com/downloads/forecast.xls&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span> <span class="attr">&quot;filename&quot;</span><span class="punctuation">:</span> <span class="string">&quot;presentation.pdf&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://example.com/downloads/presentation.pdf&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="Dynamical-Attribute">Dynamical Attribute</h2>
<p>To define attribute and structure names dynamically, use the set! method:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">json.set! <span class="symbol">:author</span> <span class="keyword">do</span></span><br><span class="line">  json.set! <span class="symbol">:name</span>, <span class="string">&#x27;David&#x27;</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =&gt; &#123;&quot;author&quot;: &#123; &quot;name&quot;: &quot;David&quot; &#125;&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="Attribute-Merge">Attribute Merge</h2>
<p>To merge existing hash or array to current context:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">hash = &#123; <span class="symbol">author:</span> &#123; <span class="symbol">name:</span> <span class="string">&quot;David&quot;</span> &#125; &#125;</span><br><span class="line">json.post <span class="keyword">do</span></span><br><span class="line">  json.title <span class="string">&quot;Merge HOWTO&quot;</span></span><br><span class="line">  json.merge! hash</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =&gt; &quot;post&quot;: &#123; &quot;title&quot;: &quot;Merge HOWTO&quot;, &quot;author&quot;: &#123; &quot;name&quot;: &quot;David&quot; &#125; &#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="Array">Array</h2>
<p>Top level arrays can be handled directly. Useful for index and other collection actions.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># <span class="doctag">@comments</span> = <span class="doctag">@post</span>.comments</span></span><br><span class="line"></span><br><span class="line">json.array! <span class="variable">@comments</span> <span class="keyword">do</span> |<span class="params">comment</span>|</span><br><span class="line">  <span class="keyword">next</span> <span class="keyword">if</span> comment.marked_as_spam_by?(current_user)</span><br><span class="line"></span><br><span class="line">  json.body comment.body</span><br><span class="line">  json.author <span class="keyword">do</span></span><br><span class="line">    json.first_name comment.author.first_name</span><br><span class="line">    json.last_name comment.author.last_name</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =&gt; [ &#123; &quot;body&quot;: &quot;great post...&quot;, &quot;author&quot;: &#123; &quot;first_name&quot;: &quot;Joe&quot;, &quot;last_name&quot;: &quot;Bloe&quot; &#125;&#125; ]</span></span><br></pre></td></tr></table></figure>
<p>You can also extract attributes from array directly.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># <span class="doctag">@people</span> = People.all</span></span><br><span class="line"></span><br><span class="line">json.array! <span class="variable">@people</span>, <span class="symbol">:id</span>, <span class="symbol">:name</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =&gt; [ &#123; &quot;id&quot;: 1, &quot;name&quot;: &quot;David&quot; &#125;, &#123; &quot;id&quot;: 2, &quot;name&quot;: &quot;Jamie&quot; &#125; ]</span></span><br></pre></td></tr></table></figure>
<h2 id="Jbuilder-Object">Jbuilder Object</h2>
<p>Jbuilder objects can be directly nested inside each other. Useful for composing objects.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># app/jbuilder/person_jbuilder.rb</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span></span><br><span class="line">  <span class="comment"># ... Class Definition ... #</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">to_builder</span></span><br><span class="line">    <span class="title class_">Jbuilder</span>.new <span class="keyword">do</span> |<span class="params">person</span>|</span><br><span class="line">      person.(<span class="variable language_">self</span>, <span class="symbol">:name</span>, <span class="symbol">:age</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Company</span></span><br><span class="line">  <span class="comment"># ... Class Definition ... #</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">to_builder</span></span><br><span class="line">    <span class="title class_">Jbuilder</span>.new <span class="keyword">do</span> |<span class="params">company</span>|</span><br><span class="line">      company.name name</span><br><span class="line">      company.president president.to_builder</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">company = <span class="title class_">Company</span>.new(<span class="string">&#x27;Doodle Corp&#x27;</span>, <span class="title class_">Person</span>.new(<span class="string">&#x27;John Stobs&#x27;</span>, <span class="number">58</span>))</span><br><span class="line">company.to_builder.target!</span><br><span class="line"></span><br><span class="line"><span class="comment"># =&gt; &#123;&quot;name&quot;:&quot;Doodle Corp&quot;,&quot;president&quot;:&#123;&quot;name&quot;:&quot;John Stobs&quot;,&quot;age&quot;:58&#125;&#125;</span></span><br></pre></td></tr></table></figure>
<p>You can either use Jbuilder stand-alone or directly as an ActionView template language. When required in Rails, you can create views a la show.json.jbuilder (the json is already yielded):</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Any helpers available to views are available to the builder</span></span><br><span class="line">json.content format_content(<span class="variable">@message</span>.content)</span><br><span class="line">json.(<span class="variable">@message</span>, <span class="symbol">:created_at</span>, <span class="symbol">:updated_at</span>)</span><br><span class="line"></span><br><span class="line">json.author <span class="keyword">do</span></span><br><span class="line">  json.name <span class="variable">@message</span>.creator.name.familiar</span><br><span class="line">  json.email_address <span class="variable">@message</span>.creator.email_address_with_name</span><br><span class="line">  json.url url_for(<span class="variable">@message</span>.creator, <span class="symbol">format:</span> <span class="symbol">:json</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> current_user.admin?</span><br><span class="line">  json.visitors calculate_visitors(<span class="variable">@message</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h2 id="Partial-Render">Partial Render</h2>
<p>You can use partials as well. The following will render the file views/comments/_comments.json.jbuilder, and set a local variable comments with all this message’s comments, which you can use inside the partial.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">json.partial! <span class="string">&#x27;comments/comments&#x27;</span>, <span class="symbol">comments:</span> <span class="variable">@message</span>.comments</span><br></pre></td></tr></table></figure>
<p>It’s also possible to render collections of partials:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">json.array! <span class="variable">@posts</span>, <span class="symbol">partial:</span> <span class="string">&#x27;posts/post&#x27;</span>, <span class="symbol">as:</span> <span class="symbol">:post</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># or</span></span><br><span class="line"></span><br><span class="line">json.partial! <span class="string">&#x27;posts/post&#x27;</span>, <span class="symbol">collection:</span> <span class="variable">@posts</span>, <span class="symbol">as:</span> <span class="symbol">:post</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># or</span></span><br><span class="line"></span><br><span class="line">json.partial! <span class="symbol">partial:</span> <span class="string">&#x27;posts/post&#x27;</span>, <span class="symbol">collection:</span> <span class="variable">@posts</span>, <span class="symbol">as:</span> <span class="symbol">:post</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># or</span></span><br><span class="line"></span><br><span class="line">json.comments <span class="variable">@post</span>.comments, <span class="symbol">partial:</span> <span class="string">&#x27;comments/comment&#x27;</span>, <span class="symbol">as:</span> <span class="symbol">:comment</span></span><br></pre></td></tr></table></figure>
<p>The as: :some_symbol is used with partials. It will take care of mapping the passed in object to a variable for the partial. If the value is a collection (either implicitly or explicitly by using the collection: option, then each value of the collection is passed to the partial as the variable some_symbol. If the value is a singular object, then the object is passed to the partial as the variable some_symbol.</p>
<p>Be sure not to confuse the as: option to mean nesting of the partial. For example:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment"># Use the default `views/comments/_comment.json.jbuilder`, putting <span class="doctag">@comment</span> as the comment local variable.</span></span><br><span class="line"> <span class="comment"># Note, `comment` attributes are &quot;inlined&quot;.</span></span><br><span class="line"> json.partial! <span class="variable">@comment</span>, <span class="symbol">as:</span> <span class="symbol">:comment</span></span><br><span class="line">is quite different <span class="symbol">than:</span></span><br><span class="line"></span><br><span class="line"> <span class="comment"># comment attributes are nested under a &quot;comment&quot; property</span></span><br><span class="line">json.comment <span class="keyword">do</span></span><br><span class="line">  json.partial! <span class="string">&quot;/comments/comment.json.jbuilder&quot;</span>, <span class="symbol">comment:</span> <span class="variable">@comment</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>You can pass any objects into partial templates with or without :locals option.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">json.partial! <span class="string">&#x27;sub_template&#x27;</span>, <span class="symbol">locals:</span> &#123; <span class="symbol">user:</span> user &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># or</span></span><br><span class="line"></span><br><span class="line">json.partial! <span class="string">&#x27;sub_template&#x27;</span>, <span class="symbol">user:</span> user</span><br></pre></td></tr></table></figure>
<p>You can explicitly make Jbuilder object return null if you want:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">json.extract! <span class="variable">@post</span>, <span class="symbol">:id</span>, <span class="symbol">:title</span>, <span class="symbol">:content</span>, <span class="symbol">:published_at</span></span><br><span class="line">json.author <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">if</span> <span class="variable">@post</span>.anonymous?</span><br><span class="line">    json.null! <span class="comment"># or json.nil!</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    json.first_name <span class="variable">@post</span>.author_first_name</span><br><span class="line">    json.last_name <span class="variable">@post</span>.author_last_name</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>To prevent Jbuilder from including null values in the output, you can use the ignore_nil! method:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">json.ignore_nil!</span><br><span class="line">json.foo <span class="literal">nil</span></span><br><span class="line">json.bar <span class="string">&quot;bar&quot;</span></span><br><span class="line"><span class="comment"># =&gt; &#123; &quot;bar&quot;: &quot;bar&quot; &#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="Fragment-caching">Fragment caching</h2>
<p>Fragment caching is supported within <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/rails/jbuilder">rails/jbuilder: Jbuilder: generate JSON objects with a Builder-style DSL - https://github.com/rails/jbuilder</a>, it uses Rails.cache and works like caching in HTML templates:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">json.cache! [<span class="string">&#x27;v1&#x27;</span>, <span class="variable">@person</span>], <span class="symbol">expires_in:</span> <span class="number">10</span>.minutes <span class="keyword">do</span></span><br><span class="line">  json.extract! <span class="variable">@person</span>, <span class="symbol">:name</span>, <span class="symbol">:age</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>You can also conditionally cache a block by using cache_if! like this:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">json.cache_if! !admin?, [<span class="string">&#x27;v1&#x27;</span>, <span class="variable">@person</span>], <span class="symbol">expires_in:</span> <span class="number">10</span>.minutes <span class="keyword">do</span></span><br><span class="line">  json.extract! <span class="variable">@person</span>, <span class="symbol">:name</span>, <span class="symbol">:age</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>If you are rendering fragments for a collection of objects, have a look at <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/yonahforst/jbuilder_cache_multi">yonahforst/jbuilder_cache_multi - https://github.com/yonahforst/jbuilder_cache_multi</a> gem. It uses fetch_multi (&gt;= Rails 4.1) to fetch multiple keys at once.</p>
<p>Renders the given block for each item in the collection. Accepts optional ‘key’ attribute in options (e.g. key: ‘v1’).</p>
<p>Note: At the moment, does not accept the partial name as an argument (#todo)</p>
<p>Examples:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">json.cache_collection! <span class="variable">@people</span>, <span class="symbol">expires_in:</span> <span class="number">10</span>.minutes <span class="keyword">do</span> |<span class="params">person</span>|</span><br><span class="line">  json.partial! <span class="string">&#x27;person&#x27;</span>, <span class="symbol">:person</span> =&gt; person</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Or with optional key</span></span><br><span class="line"></span><br><span class="line">json.cache_collection! <span class="variable">@people</span>, <span class="symbol">expires_in:</span> <span class="number">10</span>.minutes, <span class="symbol">key:</span> <span class="string">&#x27;v1&#x27;</span> <span class="keyword">do</span> |<span class="params">person</span>|</span><br><span class="line">  json.partial! <span class="string">&#x27;person&#x27;</span>, <span class="symbol">:person</span> =&gt; person</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Or with a proc as a key </span></span><br><span class="line"></span><br><span class="line">json.cache_collection! <span class="variable">@people</span>, <span class="symbol">expires_in:</span> <span class="number">10</span>.minutes, <span class="symbol">key:</span> <span class="built_in">proc</span> &#123;|<span class="params">person</span>| person.last_posted_at &#125; <span class="keyword">do</span> |<span class="params">person</span>|</span><br><span class="line">  json.partial! <span class="string">&#x27;person&#x27;</span>, <span class="symbol">:person</span> =&gt; person</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>Last thing: If you are using a collection for the cache key, may I recommend the ‘scope_cache_key’ gem? (check out my fork for a Rails 4 version: <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/joshblour/scope_cache_key">https://github.com/joshblour/scope_cache_key</a>). It very quickly calculates a hash for all items in the collection (MD5 hash of updated_at + IDs).</p>
<p>You can also conditionally cache a block by using cache_collection_if! like this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">json.cache_collection_if! do_cache?, @people, expires_in: 10.minutes do |person|</span><br><span class="line">  json.partial! &#x27;person&#x27;, :person =&gt; person</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h2 id="Key-Format">Key Format</h2>
<p>Keys can be auto formatted using key_format!. Specifies formatting to be applied to the key. Passing in a name of a function will cause that function to be called on the key.  So :upcase will upper case the key.  You can also pass in lambdas for more complex transformations.</p>
<p>Example:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">json.key_format! <span class="symbol">:upcase</span></span><br><span class="line">json.author <span class="keyword">do</span></span><br><span class="line">    json.name <span class="string">&quot;David&quot;</span></span><br><span class="line">    json.age <span class="number">32</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =&gt; &#123; &quot;AUTHOR&quot;: &#123; &quot;NAME&quot;: &quot;David&quot;, &quot;AGE&quot;: 32 &#125; &#125;</span></span><br></pre></td></tr></table></figure>
<p>You can pass parameters to the method using a hash pair.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">json.key_format! <span class="symbol">camelize:</span> <span class="symbol">:lower</span></span><br><span class="line">json.first_name <span class="string">&quot;David&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =&gt; &#123; &quot;firstName&quot;: &quot;David&quot; &#125;</span></span><br></pre></td></tr></table></figure>
<p>Lambdas can also be used.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">json.key_format! -&gt;(key)&#123; <span class="string">&quot;_&quot;</span> + key &#125;</span><br><span class="line">json.first_name <span class="string">&quot;David&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =&gt; &#123; &quot;_first_name&quot;: &quot;David&quot; &#125;</span></span><br></pre></td></tr></table></figure>
<p>You can set this globally with the class method key_format (from inside your config/initializers/jbuilder.rb or environment.rb for example):</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config/initializers/jbuilder.rb</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Jbuilder</span>.key_format <span class="symbol">camelize:</span> <span class="symbol">:lower</span></span><br></pre></td></tr></table></figure>
<p>See <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/rails/jbuilder/blob/07d31ca6b8791b1767f9186a372ae3d3cbf16cf5/lib/jbuilder.rb">lib/jbuilder.rb</a> to learn more usages.</p>
<h2 id="FAQS">FAQS</h2>
<h3 id="return-within-block-will-cause-json-can-not-render-content-within-block">return within block will cause json can not render content within block</h3>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="keyword">if</span> data.blank?</span><br><span class="line"></span><br><span class="line">json.data <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">if</span> data.is_a?(<span class="title class_">Enumerable</span>)</span><br><span class="line">    json.rows data</span><br><span class="line"></span><br><span class="line">    <span class="comment"># return within block will cause json can not render content within block.</span></span><br><span class="line">    <span class="comment"># return unless data.respond_to?(:total_count)</span></span><br><span class="line">    <span class="keyword">if</span> data.respond_to?(<span class="symbol">:total_count</span>)</span><br><span class="line">      json.total data.total_count</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h2 id="References">References</h2>
<p>[1] <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/rails/jbuilder">rails/jbuilder: Jbuilder: generate JSON objects with a Builder-style DSL - https://github.com/rails/jbuilder</a></p>
<p>[2] <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/rails/jbuilder/blob/07d31ca6b8791b1767f9186a372ae3d3cbf16cf5/lib/jbuilder.rb">jbuilder/jbuilder.rb at 07d31ca6b8791b1767f9186a372ae3d3cbf16cf5 · rails/jbuilder - https://github.com/rails/jbuilder/blob/07d31ca6b8791b1767f9186a372ae3d3cbf16cf5/lib/jbuilder.rb</a></p>
<p>[3] <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/yonahforst/jbuilder_cache_multi">yonahforst/jbuilder_cache_multi - https://github.com/yonahforst/jbuilder_cache_multi</a></p>
<p>[4] <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/yonahforst/scope_cache_key">yonahforst/scope_cache_key: Add cache_key functionality to ActiveRecord scopes - https://github.com/yonahforst/scope_cache_key - https://github.com/yonahforst/scope_cache_key</a></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>Buy me a coffee</div>
  <button>
    Donate
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/bitcoin.png" alt="CloudoLife Bitcoin">
        <span>Bitcoin</span>
      </div>

  </div>
</div>

          <div class="followme">
  <span>Welcome to my other publishing channels</span>

  <div class="social-list">

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://twitter.com/CloudoLife" rel="external nofollow noreferrer">
            <span class="icon">
              <i class="fab fa-twitter"></i>
            </span>

            <span class="label">Twitter</span>
          </a>
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://t.me/CloudoLife" rel="external nofollow noreferrer">
            <span class="icon">
              <i class="fab fa-telegram"></i>
            </span>

            <span class="label">Telegram</span>
          </a>
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/Rails-Ruby-on-Rails-RoR/" rel="tag"># Rails / Ruby on Rails (RoR)</a>
              <a href="/tags/Best-Practices/" rel="tag"># Best Practices</a>
              <a href="/tags/Ruby/" rel="tag"># Ruby</a>
              <a href="/tags/Programming-Language/" rel="tag"># Programming Language</a>
              <a href="/tags/JavaScript-Object-Notation-JSON/" rel="tag"># JavaScript Object Notation (JSON)</a>
              <a href="/tags/JSON/" rel="tag"># JSON</a>
              <a href="/tags/RESTful/" rel="tag"># RESTful</a>
              <a href="/tags/Representational-State-Transfer/" rel="tag"># Representational State Transfer</a>
              <a href="/tags/Awesome-Ruby-Gem/" rel="tag"># Awesome Ruby Gem</a>
              <a href="/tags/jbuilder/" rel="tag"># jbuilder</a>
              <a href="/tags/json-jbuilder/" rel="tag"># json.jbuilder</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2020/08/29/Programming-Language/Ruby/Ruby-on-Rails-RoR/YAML-advanced-usage-in-Ruby-on-Rails/" rel="prev" title="[Best practices] YAML usage in Ruby on Rails">
                  <i class="fa fa-angle-left"></i> [Best practices] YAML usage in Ruby on Rails
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2020/08/29/Programming-Language/Ruby/Ruby-on-Rails-RoR/Speed-Up-Your-Rails-App-RESTful-API-by-cache/" rel="next" title="[Ruby on Rails (RoR)] Speed Up Your Rails App RESTful API by cache">
                  [Ruby on Rails (RoR)] Speed Up Your Rails App RESTful API by cache <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments gitalk-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">CloudoLife</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="Word count total">2.6m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">39:58</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener external nofollow noreferrer" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener external nofollow noreferrer" target="_blank">NexT.Pisces</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"CloudoLife","repo":"col-hexo-CloudoLife.github.io","client_id":"4ca3ae8fb3a49237db9a","client_secret":"98d6652508799ef4350ab05aabe855e58f549112","admin_user":"benjamincloudolife","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":null,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"a2029011408c228ca92774f8b62dcd5e"}</script>
<script src="/js/third-party/comments/gitalk.js" defer></script>

</body>
</html>
